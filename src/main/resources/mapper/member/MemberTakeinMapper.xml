<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.temp.member.mapper.MemberTakeinMapper">


	<select id="selectCustomInfo" parameterType="hashMap" resultType="com.example.temp.member.vo.CustomerVO">
		SELECT 
			ISNULL(USER_ID,'') AS USER_ID,
			ISNULL(USER_NAME,'') AS USER_NAME,
			ISNULL(USER_PW,'') AS USER_PW,
			ISNULL(USER_TEL,'') AS USER_TEL,
			ISNULL(USER_ADDR,'') AS USER_ADDR,
			ISNULL(USER_ADDR_DETAIL,'') AS USER_ADDR_DETAIL,
			ISNULL(USER_EMAIL,'') AS USER_EMAIL,
			ISNULL(ETPR_YN,'') AS ETPR_YN,
			ISNULL(APRV_YN,'') AS APRV_YN,
			ISNULL(DEPOSIT_YN,'') AS DEPOSIT_YN,
			ISNULL(INSP_PRICE,'') AS INSP_PRICE,
			ISNULL(USER_GRADE,'') AS USER_GRADE,
			ISNULL(WT_ERR_RANGE,'') AS WT_ERR_RANGE,
			ISNULL(INSP_YN,'') AS INSP_YN,
			ISNULL(TAKE_YN,'') AS TAKE_YN,
			ISNULL(NOMAL_YN,'') AS NOMAL_YN,
			ISNULL(W_USER_ID,'') AS W_USER_ID,
			ISNULL(W_USER_IP,'') AS W_USER_IP,
			ISNULL(W_DATE,'') AS W_DATE,
			ISNULL(USER_ZIP,'') AS USER_ZIP,
			ISNULL(ROLE,'') AS ROLE,
			ISNULL(USER_E_ADDR,'') AS USER_E_ADDR,
			ISNULL(COM_NAME,'') AS COM_NAME,
			ISNULL(COM_E_NAME,'') AS COM_E_NAME,
			ISNULL(USER_E_ADDR_DETAIL,'') AS USER_E_ADDR_DETAIL,
			ISNULL(DIM_UNIT,'') AS DIM_UNIT,
			ISNULL(WT_UNIT,'') AS WT_UNIT,
			ISNULL(API_KEY,'') AS API_KEY,
			ISNULL(STOCK_WEIGHT_YN,'') AS STOCK_WEIGHT_YN,
			ISNULL(STORE_URL,'') AS STORE_URL,
			ISNULL(STORE_NAME,'') AS STORE_NAME,
			ISNULL(USER_HP,'') AS USER_HP
		 FROM TB_CUSTOMER WHERE USER_ID = #{userId}
	</select>

	 <select id='selectNNO' resultType="String">
			SELECT
			concat(replace(CONVERT(date,GETDATE()),'-',''),left(replace(CONVERT(time,GETDATE()),':',''),6),RIGHT(NEXT
			VALUE FOR
			SEQ_NNO,4),CHAR(left(round(rand(),1)*10,1)+65),CHAR(left(round(rand(),1)*10,1)+65),CHAR(left(round(rand(),1)*10,1)+65))
			AS NNO
	</select>

	<delete id="deleteTmptakeinUserList">
		DELETE FROM TMP_ORDER_LIST WHERE NNO = #{nno};
		
		DELETE FROM TMP_ORDER_ITEM WHERE NNO = #{nno};
	</delete>
	
	
	<delete id="recoveryTakeinUserList" parameterType="hashMap">
		EXEC SP_ORDER_REC2
			#{nno},
			#{userId},
			#{userIp};
	</delete>
	
	<delete id="deleteTakeinUserList" parameterType="hashMap">
		EXEC SP_ORDER_DEL2
			#{nno},
			#{userId},
			#{userIp};
		delete from TB_ORDER_ITEM WHERE NNO = #{nno} AND NNO NOT IN (SELECT NNO FROM TB_STOCK where NNO = #{nno}) AND NNO NOT IN (SELECT NNO FROM TB_HAWB  where NNO = #{nno});
		delete from TB_ORDER_LIST WHERE NNO = #{nno} AND NNO NOT IN (SELECT NNO FROM TB_STOCK  where NNO = #{nno}) AND NNO NOT IN (SELECT NNO FROM TB_HAWB  where NNO = #{nno});
	</delete>

	<select id="selectTmpTakeinUserList" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinOrderVO">
		<!-- 
		SELECT 
				ISNULL(NNO,'') AS NNO ,
				ISNULL(ORG_STATION,'') AS ORG_STATION ,
				ISNULL((SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = F1.ORG_STATION),'') AS ORG_STATION_NAME ,
				ISNULL(DSTN_NATION,'') AS DSTN_NATION ,
				ISNULL((SELECT NATION_NAME FROM TB_NATION_CODE WHERE NATION_CODE = F1.DSTN_NATION),'') AS DSTN_NATION_NAME,
				ISNULL(DSTN_STATION,'') AS DSTN_STATION ,
				ISNULL(USER_ID,'') AS USER_ID ,
				ISNULL(ORDER_TYPE,'') AS ORDER_TYPE ,
				ISNULL(ORDER_NO,'') AS ORDER_NO ,
				ISNULL(ORDER_DATE,'') AS ORDER_DATE ,
				ISNULL(HAWB_NO,'') AS HAWB_NO ,
				ISNULL(BOX_CNT,'') AS BOX_CNT ,
				ISNULL(USER_WTA,'') AS USER_WTA ,
				ISNULL(USER_WTC,'') AS USER_WTC ,
				ISNULL(SHIPPER_NAME,'') AS SHIPPER_NAME ,
				ISNULL(SHIPPER_ZIP,'') AS SHIPPER_ZIP ,
				ISNULL(SHIPPER_TEL,'') AS SHIPPER_TEL ,
				ISNULL(SHIPPER_HP,'') AS SHIPPER_HP ,
				ISNULL(SHIPPER_CNTRY,'') AS SHIPPER_CNTRY ,
				ISNULL(SHIPPER_CITY,'') AS SHIPPER_CITY ,
				ISNULL(SHIPPER_STATE,'') AS SHIPPER_STATE ,
				ISNULL(SHIPPER_ADDR,'') AS SHIPPER_ADDR ,
				ISNULL(SHIPPER_ADDR_DETAIL,'') AS SHIPPER_ADDR_DETAIL ,
				ISNULL(CNEE_NAME,'') AS CNEE_NAME ,
				ISNULL(CNEE_ADDR,'') AS CNEE_ADDR ,
				ISNULL(CNEE_ZIP,'') AS CNEE_ZIP ,
				ISNULL(CNEE_TEL,'') AS CNEE_TEL ,
				ISNULL(CNEE_HP,'') AS CNEE_HP ,
				ISNULL(CNEE_CNTRY,'') AS CNEE_CNTRY ,
				ISNULL(CNEE_CITY,'') AS CNEE_CITY ,
				ISNULL(CNEE_STATE,'') AS CNEE_STATE ,
				ISNULL(CNEE_ADDR_DETAIL,'') AS CNEE_ADDR_DETAIL ,
				ISNULL(USER_LENGTH,'') AS USER_LENGTH ,
				ISNULL(USER_WIDTH,'') AS USER_WIDTH ,
				ISNULL(USER_HEIGHT,'') AS USER_HEIGHT ,
				ISNULL(USER_EMAIL,'') AS USER_EMAIL ,
				ISNULL(TRANS_CODE,'') AS TRANS_CODE ,
				(SELECT NATION_CODE FROM TB_USER_TRANS_COM WHERE USER_ID = F1.USER_ID AND TRANS_CODE = F1.TRANS_CODE AND DSTN_NATION = F1.DSTN_NATION and ORG_NATION = (select NATION_CODE FROM TB_STATION WHERE STATION_CODE = F1.ORG_STATION)
				) TRANS_NAME,  
				ISNULL(CNEE_EMAIL,'') AS CNEE_EMAIL ,
				ISNULL(CUSTOMS_NO,'') AS CUSTOMS_NO ,
				ISNULL(NATIVE_CNEE_NAME,'') AS NATIVE_CNEE_NAME ,
				ISNULL(NATIVE_CNEE_ADDR,'') AS NATIVE_CNEE_ADDR ,
				ISNULL(NATIVE_CNEE_ADDR_DETAIL,'') AS NATIVE_CNEE_ADDR_DETAIL ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(BUY_SITE,'') AS BUY_SITE ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(W_DATE,'') AS W_DATE ,
				ISNULL(GET_BUY,'') AS GET_BUY ,
				ISNULL(MALL_TYPE,'') AS MALL_TYPE ,
				ISNULL(WH_REQ_MSG,'') AS WH_REQ_MSG ,
				ISNULL(DLV_REQ_MSG,'') AS DLV_REQ_MSG ,
				ISNULL(CNEE_DISTRICT,'') AS CNEE_DISTRICT ,
				ISNULL(STATUS,'') AS STATUS ,
				(SELECT ROUND(SUM(UNIT_VALUE * ITEM_CNT),2) FROM TMP_ORDER_ITEM WHERE NNO = F1.NNO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS TOTAL_AMT,
				(SELECT COUNT(*) FROM TMP_ORDER_LIST WHERE ORDER_NO = F1.ORDER_NO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS DUP_CNT,
				(SELECT COUNT(*) FROM TB_ORDER_LIST WHERE ORDER_NO = F1.ORDER_NO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS ALREADY,
				ISNULL((SELECT EXP_NO FROM TB_EXPLICENCE WHERE NNO = F1.NNO AND ORDER_NO = F1.ORDER_NO),'') AS EXP_NO,
				ISNULL((SELECT EXP_BUSINESS_NUM FROM TB_EXPLICENCE WHERE NNO = F1.NNO AND ORDER_NO = F1.ORDER_NO),'') AS EXP_BUSINESS_NUM,
				ISNULL((SELECT EXP_BUSINESS_NAME FROM TB_EXPLICENCE WHERE NNO = F1.NNO AND ORDER_NO = F1.ORDER_NO),'') AS EXP_BUSINESS_NAME,
				ISNULL((SELECT EXP_VALUE FROM TB_EXPLICENCE WHERE NNO = F1.NNO AND ORDER_NO = F1.ORDER_NO),'') AS EXP_VALUE,
				ISNULL((SELECT AGENCY_BUSINESS_NAME FROM TB_EXPLICENCE WHERE NNO = F1.NNO AND ORDER_NO = F1.ORDER_NO),'') AS AGENCY_BUSINESS_NAME
			FROM TMP_ORDER_LIST F1
			WHERE USER_ID = #{userId} AND ORDER_TYPE='takein'
			 -->
			 SELECT 
				ISNULL(F1.NNO,'') AS NNO ,
				ISNULL(ORG_STATION,'') AS ORG_STATION ,
				ISNULL((SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = F1.ORG_STATION),'') AS ORG_STATION_NAME ,
				ISNULL(DSTN_NATION,'') AS DSTN_NATION ,
				ISNULL((SELECT NATION_NAME FROM TB_NATION_CODE WHERE NATION_CODE = F1.DSTN_NATION),'') AS DSTN_NATION_NAME,
				ISNULL(DSTN_STATION,'') AS DSTN_STATION ,
				ISNULL(F1.USER_ID,'') AS USER_ID ,
				ISNULL(ORDER_TYPE,'') AS ORDER_TYPE ,
				ISNULL(ORDER_NO,'') AS ORDER_NO ,
				ISNULL(ORDER_DATE,'') AS ORDER_DATE ,
				ISNULL(HAWB_NO,'') AS HAWB_NO ,
				ISNULL(BOX_CNT,'') AS BOX_CNT ,
				ISNULL(USER_WTA,'') AS USER_WTA ,
				ISNULL(USER_WTC,'') AS USER_WTC ,
				ISNULL(SHIPPER_NAME,'') AS SHIPPER_NAME ,
				ISNULL(SHIPPER_ZIP,'') AS SHIPPER_ZIP ,
				ISNULL(SHIPPER_TEL,'') AS SHIPPER_TEL ,
				ISNULL(SHIPPER_HP,'') AS SHIPPER_HP ,
				ISNULL(SHIPPER_CNTRY,'') AS SHIPPER_CNTRY ,
				ISNULL(SHIPPER_CITY,'') AS SHIPPER_CITY ,
				ISNULL(SHIPPER_STATE,'') AS SHIPPER_STATE ,
				ISNULL(SHIPPER_ADDR,'') AS SHIPPER_ADDR ,
				ISNULL(SHIPPER_ADDR_DETAIL,'') AS SHIPPER_ADDR_DETAIL ,
				ISNULL(CNEE_NAME,'') AS CNEE_NAME ,
				ISNULL(CNEE_ADDR,'') AS CNEE_ADDR ,
				ISNULL(CNEE_ZIP,'') AS CNEE_ZIP ,
				ISNULL(CNEE_TEL,'') AS CNEE_TEL ,
				ISNULL(CNEE_HP,'') AS CNEE_HP ,
				ISNULL(CNEE_CNTRY,'') AS CNEE_CNTRY ,
				ISNULL(CNEE_CITY,'') AS CNEE_CITY ,
				ISNULL(CNEE_STATE,'') AS CNEE_STATE ,
				ISNULL(CNEE_ADDR_DETAIL,'') AS CNEE_ADDR_DETAIL ,
				ISNULL(USER_LENGTH,'') AS USER_LENGTH ,
				ISNULL(USER_WIDTH,'') AS USER_WIDTH ,
				ISNULL(USER_HEIGHT,'') AS USER_HEIGHT ,
				ISNULL(USER_EMAIL,'') AS USER_EMAIL ,
				ISNULL(TRANS_CODE,'') AS TRANS_CODE ,
				(SELECT NATION_CODE FROM TB_USER_TRANS_COM WHERE USER_ID = F1.USER_ID AND TRANS_CODE = F1.TRANS_CODE AND DSTN_NATION = F1.DSTN_NATION and ORG_NATION = (select NATION_CODE FROM TB_STATION WHERE STATION_CODE = F1.ORG_STATION)
				) TRANS_NAME,  
				ISNULL(CNEE_EMAIL,'') AS CNEE_EMAIL ,
				ISNULL(CUSTOMS_NO,'') AS CUSTOMS_NO ,
				ISNULL(NATIVE_CNEE_NAME,'') AS NATIVE_CNEE_NAME ,
				ISNULL(NATIVE_CNEE_ADDR,'') AS NATIVE_CNEE_ADDR ,
				ISNULL(NATIVE_CNEE_ADDR_DETAIL,'') AS NATIVE_CNEE_ADDR_DETAIL ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(BUY_SITE,'') AS BUY_SITE ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(F1.W_DATE,'') AS W_DATE ,
				ISNULL(GET_BUY,'') AS GET_BUY ,
				ISNULL(MALL_TYPE,'') AS MALL_TYPE ,
				ISNULL(WH_REQ_MSG,'') AS WH_REQ_MSG ,
				ISNULL(DLV_REQ_MSG,'') AS DLV_REQ_MSG ,
				ISNULL(CNEE_DISTRICT,'') AS CNEE_DISTRICT ,
				ISNULL(STATUS,'') AS STATUS ,
				(SELECT ROUND(SUM(UNIT_VALUE * ITEM_CNT),2) FROM TMP_ORDER_ITEM WHERE NNO = F1.NNO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS TOTAL_AMT,
				(SELECT COUNT(*) FROM TMP_ORDER_LIST WHERE ORDER_NO = F1.ORDER_NO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS DUP_CNT,
				(SELECT COUNT(*) FROM TB_ORDER_LIST WHERE ORDER_NO = F1.ORDER_NO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS ALREADY,
				ISNULL(F2.SEND_YN,'') AS SEND_YN,
				ISNULL(F2.EXP_TYPE,'N') AS EXP_TYPE,
				ISNULL(F2.EXP_COR,'') AS EXP_COR,
				ISNULL(F2.EXP_RPRSN,'') AS EXP_RPRSN,
				ISNULL(F2.EXP_ADDR,'00NECwQh10Wxb0w0BjtJlw==') AS EXP_ADDR,
				ISNULL(F2.EXP_ZIP,'') AS EXP_ZIP,
				ISNULL(F2.EXP_RGSTR_NO,'00NECwQh10Wxb0w0BjtJlw==') AS EXP_RGSTR_NO,
				ISNULL(F2.EXP_CST_CD,'00NECwQh10Wxb0w0BjtJlw==') AS EXP_CST_CD,
				ISNULL(F2.AGT_COR,'') AS AGT_COR,
				ISNULL(F2.AGT_CST_CD,'00NECwQh10Wxb0w0BjtJlw==') AS AGT_CST_CD,
				ISNULL(F2.AGT_BIZ_NO,'') AS AGT_BIZ_NO,
				ISNULL(F2.EXP_NO,'') AS EXP_NO
			FROM TMP_ORDER_LIST F1
			LEFT OUTER JOIN TB_EXP_DCL F2 ON F1.NNO = F2.NNO AND F1.USER_ID = F2.USER_ID
			WHERE F1.USER_ID = #{userId} AND F1.ORDER_TYPE='takein'
	</select>
	
	<select id="selectErrorMsg" parameterType="String" resultType="String">
		SELECT NAME FROM TB_ARA_CODE WHERE CODE IN 
				(SELECT * FROM FN_SPLIT((SELECT [STATUS] FROM TMP_ORDER_LIST WHERE nno = #{nno}) ,','))
		UNION ALL
		SELECT VALUE AS NAME FROM FN_SPLIT((SELECT [STATUS] FROM TMP_ORDER_LIST WHERE nno = #{nno}) ,',') 
			WHERE VALUE NOT IN (SELECT CODE FROM TB_ARA_CODE)
	
	</select>
	<!-- SELECT NAME FROM TB_ARA_CODE WHERE CODE= #{status} -->
	<select id="selectTmpTakeinUserOrderItem" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinOrderItemListVO">
		SELECT
				ISNULL(NNO,'') AS NNO ,
				ISNULL(SUB_NO,0) AS SUB_NO ,
				ISNULL(ORG_STATION,'') AS ORG_STATION ,
				ISNULL(USER_ID,'') AS USER_ID ,
				ISNULL(HS_CODE,'') AS HS_CODE ,
				ISNULL(ITEM_DETAIL,'') AS ITEM_DETAIL ,
				ISNULL(UNIT_CURRENCY,'') AS UNIT_CURRENCY ,
				ISNULL(ITEM_CNT,0) AS ITEM_CNT ,
				ISNULL(UNIT_VALUE,'') AS UNIT_VALUE ,
				ISNULL(BRAND,'') AS BRAND ,
				ISNULL(MAKE_CNTRY,'') AS MAKE_CNTRY ,
				ISNULL(MAKE_COM,'') AS MAKE_COM ,
				ISNULL(ITEM_DIV,'') AS ITEM_DIV ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(QTY_UNIT,'') AS QTY_UNIT ,
				ISNULL(PACKAGE_UNIT,'') AS PACKAGE_UNIT ,
				ISNULL(EXCHANGE_RATE,'') AS EXCHANGE_RATE ,
				ISNULL(CHG_CURRENCY,'') AS CHG_CURRENCY ,
				ISNULL(CHG_AMT,0) AS CHG_AMT ,
				ISNULL(ITEM_METERIAL,'') AS ITEM_METERIAL ,
				ISNULL(TAKE_IN_CODE,'') AS TAKE_IN_CODE ,
				ISNULL(USER_WTA,'') AS USER_WTA ,
				ISNULL(USER_WTC,'') AS USER_WTC ,
				ISNULL(ITEM_URL,'') AS ITEM_URL ,
				ISNULL(ITEM_IMG_URL,'') AS ITEM_IMG_URL ,
				ISNULL(STATUS,'') AS STATUS ,
				ISNULL(TRK_COM,'') AS TRK_COM ,
				ISNULL(TRK_NO,'') AS TRK_NO ,
				ISNULL(TRK_DATE,'') AS TRK_DATE ,
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL ,
				ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(W_DATE,'') AS W_DATE ,
				(SELECT COUNT(*) FROM TB_STOCK WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION AND STOCK_TYEP = 'TAKE_IN' AND OUT_NNO = '')  -
				(SELECT SUM(ITEM_CNT) FROM TMP_ORDER_ITEM WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) STOCK_CNT
			FROM TMP_ORDER_ITEM F1
			WHERE NNO = #{nno}
			 AND USER_ID = #{userId}
			 and ORG_STATION = #{orgStation}
	</select>
	
	<select id="selectTmpTakeinUserOrderItem2" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinOrderItemListVO">
		SELECT
				ISNULL(NNO,'') AS NNO ,
				ISNULL(SUB_NO,0) AS SUB_NO ,
				ISNULL(ORG_STATION,'') AS ORG_STATION ,
				ISNULL(USER_ID,'') AS USER_ID ,
				ISNULL(HS_CODE,'') AS HS_CODE ,
				ISNULL(ITEM_DETAIL,'') AS ITEM_DETAIL ,
				ISNULL(UNIT_CURRENCY,'') AS UNIT_CURRENCY ,
				ISNULL(ITEM_CNT,0) AS ITEM_CNT ,
				ISNULL(UNIT_VALUE,'') AS UNIT_VALUE ,
				ISNULL(BRAND,'') AS BRAND ,
				ISNULL(MAKE_CNTRY,'') AS MAKE_CNTRY ,
				ISNULL(MAKE_COM,'') AS MAKE_COM ,
				ISNULL(ITEM_DIV,'') AS ITEM_DIV ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(QTY_UNIT,'') AS QTY_UNIT ,
				ISNULL(PACKAGE_UNIT,'') AS PACKAGE_UNIT ,
				ISNULL(EXCHANGE_RATE,'') AS EXCHANGE_RATE ,
				ISNULL(CHG_CURRENCY,'') AS CHG_CURRENCY ,
				ISNULL(CHG_AMT,0) AS CHG_AMT ,
				ISNULL(ITEM_METERIAL,'') AS ITEM_METERIAL ,
				ISNULL(TAKE_IN_CODE,'') AS TAKE_IN_CODE ,
				ISNULL(USER_WTA,'') AS USER_WTA ,
				ISNULL(USER_WTC,'') AS USER_WTC ,
				ISNULL(ITEM_URL,'') AS ITEM_URL ,
				ISNULL(ITEM_IMG_URL,'') AS ITEM_IMG_URL ,
				ISNULL(STATUS,'') AS STATUS ,
				ISNULL(TRK_COM,'') AS TRK_COM ,
				ISNULL(TRK_NO,'') AS TRK_NO ,
				ISNULL(TRK_DATE,'') AS TRK_DATE ,
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL ,
				ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(W_DATE,'') AS W_DATE ,
				(SELECT COUNT(*) FROM TB_STOCK WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION AND STOCK_TYEP = 'TAKE_IN' AND OUT_NNO = '')  -
				(SELECT SUM(ITEM_CNT) FROM TMP_ORDER_ITEM WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) STOCK_CNT
			FROM TMP_ORDER_ITEM F1
			WHERE 
			NNO IN
			<foreach collection="takeinList" item="value" open="(" close=")" separator=",">
				#{value.nno}
			</foreach>
			 AND 
			 USER_ID = #{userId}
			 and ORG_STATION = #{orgStation}
	</select>
	
	<select id="selectTotalCountTakeinList" parameterType="hashMap" resultType="integer">
		SELECT COUNT(*)
		  FROM TB_ORDER_LIST F1
		 WHERE ORDER_TYPE = 'TAKEIN'
		   AND NNO NOT IN(SELECT NNO FROM TB_HAWB WHERE USER_ID =  #{userId})
		   AND USER_ID = #{userId}
		   <if test="startDate != null and startDate != ''">
		   		AND SUBSTRING(W_DATE,1,8) <![CDATA[>=]]> #{startDate}
		   </if>
		   <if test='endDate != null and endDate != ""'>
		   		AND SUBSTRING(W_DATE,1,8) <![CDATA[<=]]> #{endDate}
		   </if>
	</select>
	
	<select id="selectTakeinUserList" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinOrderVO">
		SELECT * FROM ( SELECT	ROW_NUMBER() OVER(ORDER BY F1.NNO DESC) ROWNUM,
		  NNO ,
					ISNULL(ORG_STATION,'') AS ORG_STATION,
					ISNULL((SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = F1.ORG_STATION),'') AS ORG_STATION_NAME,
					ISNULL(DSTN_NATION,'') AS DSTN_NATION,
					ISNULL((SELECT NATION_NAME FROM TB_NATION_CODE WHERE NATION_CODE = F1.DSTN_NATION),'') AS DSTN_NATION_NAME,
					ISNULL(USER_ID,'') AS USER_ID,
					ISNULL(ORDER_TYPE,'') AS ORDER_TYPE,
					ISNULL(ORDER_NO,'') AS ORDER_NO,
					ISNULL(ORDER_DATE,'') AS ORDER_DATE,
					ISNULL(HAWB_NO,'') AS HAWB_NO,
					ISNULL(USER_WTA,'') AS  USER_WTA,
					ISNULL(USER_WTC,'') AS USER_WTC,
					ISNULL(CNEE_CITY,'') AS CNEE_CITY,
					ISNULL(CNEE_STATE,'') AS CNEE_STATE,
					ISNULL(CNEE_NAME,'') AS CNEE_NAME,
					ISNULL(CNEE_TEL,'') AS CNEE_TEL,
					ISNULL(CNEE_HP,'') AS CNEE_HP,
					ISNULL(CNEE_EMAIL,'') AS CNEE_EMAIL,
					ISNULL(CNEE_ZIP,'') AS CNEE_ZIP,
					ISNULL(CNEE_ADDR,'') AS CNEE_ADDR,
					ISNULL(CNEE_ADDR_DETAIL,'') AS CNEE_ADDR_DETAIL,
					(SELECT SUM(UNIT_VALUE * ITEM_CNT) FROM TB_ORDER_ITEM WHERE NNO = F1.NNO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS TOTAL_AMT
				FROM TB_ORDER_LIST F1
			   WHERE ORDER_TYPE = 'TAKEIN'
			     AND USER_ID = #{userId}  
			     AND HAWB_NO like CONCAT('%',#{hawbNo},'%')
			     AND ORDER_NO like CONCAT('%',#{orderNo},'%')
			     AND CNEE_NAME like  CONCAT('%',#{cneeName},'%')
			     AND NNO NOT IN(SELECT NNO FROM TB_HAWB WHERE USER_ID =  #{userId})
			     <if test="startDate != null and startDate != ''">
			   		AND SUBSTRING(W_DATE,1,8) <![CDATA[>=]]> #{startDate}
			   </if>
			   <if test='endDate != null and endDate != ""'>
			   		AND SUBSTRING(W_DATE,1,8) <![CDATA[<=]]> #{endDate}
			   </if>
			 ) M1
			WHERE M1.ROWNUM BETWEEN #{paging.boardStart} and #{paging.boardEnd} 
	</select>
	
	<select id="selectTakeinUserOrderItem" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinOrderItemListVO">
		SELECT
				ISNULL(NNO,'') AS NNO ,
				ISNULL(SUB_NO,0) AS SUB_NO ,
				ISNULL(ORG_STATION,'') AS ORG_STATION ,
				ISNULL(USER_ID,'') AS USER_ID ,
				ISNULL(HS_CODE,'') AS HS_CODE ,
				ISNULL(ITEM_DETAIL,'') AS ITEM_DETAIL ,
				ISNULL(UNIT_CURRENCY,'') AS UNIT_CURRENCY ,
				ISNULL(ITEM_CNT,0) AS ITEM_CNT ,
				ISNULL(UNIT_VALUE,'') AS UNIT_VALUE ,
				ISNULL(BRAND,'') AS BRAND ,
				ISNULL(MAKE_CNTRY,'') AS MAKE_CNTRY ,
				ISNULL(MAKE_COM,'') AS MAKE_COM ,
				ISNULL(ITEM_DIV,'') AS ITEM_DIV ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(QTY_UNIT,'') AS QTY_UNIT ,
				ISNULL(PACKAGE_UNIT,'') AS PACKAGE_UNIT ,
				ISNULL(EXCHANGE_RATE,'') AS EXCHANGE_RATE ,
				ISNULL(CHG_CURRENCY,'') AS CHG_CURRENCY ,
				ISNULL(CHG_AMT,0) AS CHG_AMT ,
				ISNULL(ITEM_METERIAL,'') AS ITEM_METERIAL ,
				ISNULL(TAKE_IN_CODE,'') AS TAKE_IN_CODE ,
				ISNULL(USER_WTA,'') AS USER_WTA ,
				ISNULL(USER_WTC,'') AS USER_WTC ,
				ISNULL(ITEM_URL,'') AS ITEM_URL ,
				ISNULL(ITEM_IMG_URL,'') AS ITEM_IMG_URL ,
				'' AS STATUS ,
				ISNULL(TRK_COM,'') AS TRK_COM ,
				ISNULL(TRK_NO,'') AS TRK_NO ,
				ISNULL(TRK_DATE,'') AS TRK_DATE ,
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL ,
				ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE ,
				'' AS DIM_UNIT ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(W_DATE,'') AS W_DATE 
			FROM TB_ORDER_ITEM
			WHERE NNO = #{nno}
			 AND USER_ID = #{userId}
			 AND ORG_STATION = #{orgStation}
	</select>
	<insert id="insertTmpTakeinOrder" parameterType="com.example.temp.member.vo.takein.TmpTakeinOrderVO">
		INSERT INTO TMP_ORDER_LIST(
					NNO,ORG_STATION,DSTN_NATION,DSTN_STATION,USER_ID,ORDER_TYPE,ORDER_NO,HAWB_NO,BOX_CNT,USER_WTA,USER_WTC,SHIPPER_NAME,SHIPPER_ZIP,SHIPPER_TEL,SHIPPER_HP,SHIPPER_CNTRY,SHIPPER_CITY,SHIPPER_STATE,SHIPPER_ADDR,SHIPPER_ADDR_DETAIL,
					CNEE_NAME,CNEE_ADDR,CNEE_ZIP,CNEE_TEL,CNEE_HP,CNEE_EMAIL,CNEE_CNTRY,CNEE_CITY,CNEE_STATE,CNEE_ADDR_DETAIL,
					USER_LENGTH,USER_WIDTH,USER_HEIGHT,USER_EMAIL,W_USER_ID,W_USER_IP,W_DATE,TRANS_CODE,ORDER_DATE,STATUS,CUSTOMS_NO,
					NATIVE_CNEE_NAME,NATIVE_CNEE_ADDR,NATIVE_CNEE_ADDR_DETAIL,DIM_UNIT,WT_UNIT,BUY_SITE,GET_BUY,MALL_TYPE,WH_REQ_MSG,DLV_REQ_MSG,CNEE_DISTRICT,
					PAYMENT,DECL_TYPE,UPLOAD_TYPE,CNEE_WARD,COSMETIC,SIGN,SHIPPER_TAX_TYPE,SHIPPER_TAX_NO,CNEE_TAX_TYPE,CNEE_TAX_NO
				) VALUES (
				#{nno},
				#{orgStation},
				(SELECT NATION_CODE FROM TB_NATION_CODE WHERE NATION_E_NAME = #{dstnNation}),
				#{dstnStation},
				#{userId},
				#{orderType},
				#{orderNo},
				#{hawbNo},
				#{boxCnt},
				#{userWta},
				#{userWtc},
				#{shipperName},
				#{shipperZip},
				#{shipperTel},
				#{shipperHp},
				#{shipperCntry},
				#{shipperCity},
				#{shipperState},
				#{shipperAddr},
				#{shipperAddrDetail},
				#{cneeName},
				#{cneeAddr},
				#{cneeZip},
				#{cneeTel},
				#{cneeHp},
				#{cneeEmail},
				#{cneeCntry},
				#{cneeCity},
				#{cneeState},
				#{cneeAddrDetail},
				#{userLength},
				#{userWidth},
				#{userHeight},
				#{userEmail},
				#{wUserId},
				#{wUserIp},
				REPLACE(CONCAT(CONVERT(CHAR(8),GETDATE(),112),CONVERT(CHAR(8),GETDATE(),108)),':',''),
				#{transCode},
				#{orderDate},
				#{status},
				#{customsNo},
				#{nativeCneeName},
				#{nativeCneeAddr},
				#{nativeCneeAddrDetail},
				#{dimUnit},
				#{wtUnit},
				#{buySite},
				#{getBuy},
				#{mallType},
				#{whReqMsg},
				#{dlvReqMsg},
				#{cneeDistrict},
		<choose>
			<when test='payment != null and payment != ""'>
				#{payment},
			</when>
			<otherwise>
				'DDU',
			</otherwise>
		</choose>
				#{declType},
				#{uploadType},
				#{cneeWard},
				#{cosmetic},
				#{sign},
				#{shipperTaxType},
				#{shipperTaxNo},
				#{cneeTaxType},
				#{cneeTaxNo}
				)
	</insert>
	
	<insert id="insertTmpTakeinOrderItem" parameterType="com.example.temp.member.vo.takein.TmpTakeinOrderItemVO">
		INSERT INTO TMP_ORDER_ITEM (
			NNO, SUB_NO, ORG_STATION, USER_ID, HS_CODE, TAKE_IN_CODE, ITEM_DETAIL, ITEM_CNT,
			BRAND, MAKE_CNTRY, MAKE_COM, ITEM_DIV, WT_UNIT, QTY_UNIT, PACKAGE_UNIT, EXCHANGE_RATE,
			CHG_AMT, ITEM_METERIAL, USER_WTA, USER_WTC, ITEM_URL, ITEM_IMG_URL, STATUS, TRK_COM, TRK_NO, TRK_DATE,  
			UNIT_CURRENCY,
			UNIT_VALUE,
			CHG_CURRENCY,
			NATIVE_ITEM_DETAIL, CUS_ITEM_CODE, W_USER_ID, W_USER_IP, W_DATE
		)
		SELECT 
			#{nno} as NNO, #{subNo} as SUB_NO, #{orgStation} as ORG_STATION, #{userId} as USER_ID, HS_CODE, TAKE_IN_CODE, ITEM_DETAIL, #{itemCnt} as ITEM_CNT,
			BRAND, MAKE_CNTRY, MAKE_COM, ITEM_DIV, WT_UNIT, QTY_UNIT, NULL PACKAGE_UNIT, NULL EXCHANGE_RATE,
			NULL CHG_AMT, ITEM_METERIAL, WTA, WTC, ITEM_URL, ITEM_IMG_URL, NULL STATUS, NULL TRK_COM, NULL TRK_NO, GETDATE(),
	<choose>
		<when test='chgCurrency != null and chgCurrency != ""'>
			#{chgCurrency} AS UNIT_CURRENCY,
		</when>
		<otherwise>
			UNIT_CURRENCY,
		</otherwise>
	</choose>
	<choose>
		<when test='unitValue != null and unitValue != ""'>
			#{unitValue} AS UNIT_VALUE,
		</when>
		<otherwise>
			UNIT_VALUE,
		</otherwise>
	</choose>
	<choose>
		<when test='chgCurrency != null and chgCurrency != ""'>
			#{chgCurrency} AS UNIT_CURRENCY,
		</when>
		<otherwise>
			UNIT_CURRENCY,
		</otherwise>
	</choose> 
	<choose>
		<when test='nativeItemDetail != null and nativeItemDetail != ""'>
			#{nativeItemDetail} AS NATIVE_ITEM_DETAIL,
		</when>
		<otherwise>
			NATIVE_ITEM_DETAIL,
		</otherwise>
	</choose>
			CUS_ITEM_CODE, #{wUserId} as W_USER_ID, #{wUserIp} as W_USER_IP, GETDATE()
		FROM TB_TAKEIN_CODE F1 
		WHERE ORG_STATION = #{orgStation}
		  AND USER_ID = #{userId} 
		  AND CUS_ITEM_CODE = #{cusItemCode}
	</insert>

	
	<select id="selectDelTotalCountTakeinList" parameterType="hashMap" resultType="integer">
		SELECT COUNT(*)
		  FROM DEL_ORDER_LIST F1
		 WHERE ORDER_TYPE = 'TAKEIN'
		   AND NNO NOT IN(SELECT NNO FROM TB_HAWB WHERE USER_ID =  #{userId})
		   AND USER_ID = #{userId}
	</select>
	
	
	<select id="selectDelTakeinUserList" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinOrderVO">
		SELECT * FROM ( SELECT	ROW_NUMBER() OVER(ORDER BY F1.NNO DESC) ROWNUM,
		  DNO AS NNO ,
								ISNULL(ORG_STATION,'') AS ORG_STATION,
								ISNULL((SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = F1.ORG_STATION),'') AS ORG_STATION_NAME ,
								ISNULL(DSTN_NATION,'') AS DSTN_NATION,
								ISNULL((SELECT NATION_NAME FROM TB_NATION_CODE WHERE NATION_CODE = F1.DSTN_NATION),'') AS DSTN_NATION_NAME,
								ISNULL(USER_ID,'') AS USER_ID,
								ISNULL(ORDER_TYPE,'') AS ORDER_TYPE,
								ISNULL(ORDER_NO,'') AS ORDER_NO,
								ISNULL(ORDER_DATE,'') AS ORDER_DATE,
								ISNULL(HAWB_NO,'') AS HAWB_NO,
								ISNULL(USER_WTA,'') AS  USER_WTA,
								ISNULL(USER_WTC,'') AS USER_WTC,
								ISNULL(CNEE_CITY,'') AS CNEE_CITY,
								ISNULL(CNEE_STATE,'') AS CNEE_STATE,
								ISNULL(CNEE_NAME,'') AS CNEE_NAME,
								ISNULL(CNEE_TEL,'') AS CNEE_TEL,
								ISNULL(CNEE_HP,'') AS CNEE_HP,
								ISNULL(CNEE_ZIP,'') AS CNEE_ZIP,
								ISNULL(CNEE_ADDR,'') AS CNEE_ADDR,
								ISNULL(CNEE_ADDR_DETAIL,'') AS CNEE_ADDR_DETAIL,
								(SELECT SUM(UNIT_VALUE * ITEM_CNT) FROM DEL_ORDER_ITEM WHERE NNO = F1.NNO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS TOTAL_AMT,
								ISNULL(D_USER_ID,'') AS D_USER_ID,
								ISNULL(D_USER_IP,'') AS D_USER_IP,
								ISNULL(D_DATE,'') AS D_DATE
							FROM DEL_ORDER_LIST F1
						   WHERE ORDER_TYPE = 'TAKEIN'
						     AND USER_ID = #{userId}  
						     AND HAWB_NO like CONCAT('%',#{hawbNo},'%')
						     AND ORDER_NO like CONCAT('%',#{orderNo},'%')
						     AND CNEE_NAME like  CONCAT('%',#{cneeName},'%')
						     AND NNO NOT IN(SELECT NNO FROM TB_HAWB WHERE USER_ID =  #{userId})
						     AND ISNULL(R_USER_ID,'') = ''
						 ) M1
						WHERE M1.ROWNUM BETWEEN #{paging.boardStart} and #{paging.boardEnd} 
	</select>
	
		<select id="selectDelTakeinUserOrderItem" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinOrderItemListVO">
		SELECT
				ISNULL(NNO,'') AS NNO ,
				ISNULL(SUB_NO,0) AS SUB_NO ,
				ISNULL(ORG_STATION,'') AS ORG_STATION ,
				ISNULL(USER_ID,'') AS USER_ID ,
				ISNULL(HS_CODE,'') AS HS_CODE ,
				ISNULL(ITEM_DETAIL,'') AS ITEM_DETAIL ,
				ISNULL(UNIT_CURRENCY,'') AS UNIT_CURRENCY ,
				ISNULL(ITEM_CNT,0) AS ITEM_CNT ,
				ISNULL(UNIT_VALUE,'') AS UNIT_VALUE ,
				ISNULL(BRAND,'') AS BRAND ,
				ISNULL(MAKE_CNTRY,'') AS MAKE_CNTRY ,
				ISNULL(MAKE_COM,'') AS MAKE_COM ,
				ISNULL(ITEM_DIV,'') AS ITEM_DIV ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(QTY_UNIT,'') AS QTY_UNIT ,
				ISNULL(PACKAGE_UNIT,'') AS PACKAGE_UNIT ,
				ISNULL(EXCHANGE_RATE,'') AS EXCHANGE_RATE ,
				ISNULL(CHG_CURRENCY,'') AS CHG_CURRENCY ,
				ISNULL(CHG_AMT,0) AS CHG_AMT ,
				ISNULL(ITEM_METERIAL,'') AS ITEM_METERIAL ,
				ISNULL(TAKE_IN_CODE,'') AS TAKE_IN_CODE ,
				ISNULL(USER_WTA,'') AS USER_WTA ,
				ISNULL(USER_WTC,'') AS USER_WTC ,
				ISNULL(ITEM_URL,'') AS ITEM_URL ,
				ISNULL(ITEM_IMG_URL,'') AS ITEM_IMG_URL ,
				ISNULL(TRK_COM,'') AS TRK_COM ,
				ISNULL(TRK_NO,'') AS TRK_NO ,
				ISNULL(TRK_DATE,'') AS TRK_DATE ,
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL ,
				ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(W_DATE,'') AS W_DATE ,
				(SELECT COUNT(*) FROM TB_STOCK WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION AND STOCK_TYEP = 'TAKE_IN' AND OUT_NNO = '')  -
				(SELECT SUM(ITEM_CNT) FROM TMP_ORDER_ITEM WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) STOCK_CNT
			FROM DEL_ORDER_ITEM F1
			WHERE NNO = #{nno}
			 AND USER_ID = #{userId}
			 and ORG_STATION = #{orgStation}
	</select>

	<select id="selectUserTakeinCountTakeinList" parameterType="hashMap" resultType="integer">
		 SELECT COUNT(*)
FROM TB_TAKEIN_CODE F1
          WHERE USE_YN = #{useYn}
		    AND USER_ID =#{userId}
		    AND ITEM_DETAIL LIKE CONCAT('%',#{itemDetail},'%')
		    AND CUS_ITEM_CODE LIKE CONCAT('%',#{cusItemCode},'%')
		    AND ORG_STATION LIKE CONCAT('%',#{orgStation},'%')
	</select>
	
	<select id="selectUserTakeInInfo" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TakeinInfoVO">
	    SELECT 
	    		ISNULL(ROWNUM,'') AS ROWNUM , 
				ISNULL(STATION_NAME,'') AS STATION_NAME , 
				ISNULL(TAKE_IN_CODE,'') AS TAKE_IN_CODE , 
				ISNULL(ORG_STATION,'') AS ORG_STATION , 
				ISNULL(USER_ID,'') AS USER_ID , 
				ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE , 
				ISNULL(HS_CODE,'') AS HS_CODE , 
				ISNULL(BRAND,'') AS BRAND , 
				ISNULL(ITEM_DETAIL,'') AS ITEM_DETAIL , 
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL , 
				ISNULL(ITEM_OPTION,'') AS ITEM_OPTION , 
				ISNULL(UNIT_VALUE,'') AS UNIT_VALUE , 
				ISNULL(UNIT_CURRENCY,'') AS UNIT_CURRENCY , 
				ISNULL(WTA,'') AS WTA , 
				ISNULL(WTC,'') AS WTC , 
				ISNULL(WT_UNIT,'') AS WT_UNIT , 
				ISNULL(QTY_UNIT,'') AS QTY_UNIT , 
				ISNULL(ITEM_URL,'') AS ITEM_URL , 
				ISNULL(ITEM_IMG_URL,'') AS ITEM_IMG_URL , 
				ISNULL(ITEM_METERIAL,'') AS ITEM_METERIAL , 
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL,
				ISNULL(ITEM_DIV,'') AS ITEM_DIV , 
				ISNULL(MAKE_CNTRY,'') AS MAKE_CNTRY , 
				ISNULL(MAKE_COM,'') AS MAKE_COM , 
				ISNULL(W_USER_ID,'') AS W_USER_ID , 
				ISNULL(W_USER_IP,'') AS W_USER_IP , 
				ISNULL(W_DATE,'') AS W_DATE , 
				ISNULL(USE_YN,'') AS USE_YN , 
				ISNULL(APPV_YN,'') AS APPV_YN , 
				ISNULL(WH_IN_CNT,'') AS WH_IN_CNT , 
				ISNULL(WH_OUT_CNT,'') AS WH_OUT_CNT  ,
				ISNULL(STOCK_CNT,'') AS STOCK_CNT 
	      FROM ( SELECT	ROW_NUMBER() OVER(ORDER BY F1.CUS_ITEM_CODE) ROWNUM,
	      (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE= F1.ORG_STATION) STATION_NAME ,
	      TAKE_IN_CODE,ORG_STATION,USER_ID,CUS_ITEM_CODE,
      							HS_CODE,BRAND,ITEM_DETAIL,NATIVE_ITEM_DETAIL,
      							ITEM_OPTION,UNIT_VALUE,UNIT_CURRENCY,WTA,WTC,WT_UNIT,
      							QTY_UNIT,ITEM_URL,ITEM_IMG_URL,ITEM_METERIAL,ITEM_DIV,
      							UPPER(MAKE_CNTRY) AS  MAKE_CNTRY,MAKE_COM,W_USER_ID,W_USER_IP,W_DATE,USE_YN,APPV_YN,
      							(SELECT COUNT(*) FROM TB_STOCK 
      							  WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE 
      							   AND USER_ID = F1.USER_ID 
      							   AND ORG_STATION = F1.ORG_STATION ) WH_IN_CNT,
      							 (SELECT COUNT(*) FROM TB_STOCK 
      							  WHERE ISNULL(OUT_NNO,'') != ''
      							   AND TAKE_IN_CODE = F1.TAKE_IN_CODE 
      							   AND USER_ID = F1.USER_ID 
      							   AND ORG_STATION = F1.ORG_STATION) WH_OUT_CNT,
      							   (SELECT COUNT(*) FROM TB_STOCK 
      							  WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE 
      							   AND USER_ID = F1.USER_ID 
      							   AND ORG_STATION = F1.ORG_STATION )-
      							 (SELECT COUNT(*) FROM TB_STOCK 
      							  WHERE ISNULL(OUT_NNO,'') != ''
      							   AND TAKE_IN_CODE = F1.TAKE_IN_CODE 
      							   AND USER_ID = F1.USER_ID 
      							   AND ORG_STATION = F1.ORG_STATION) STOCK_CNT
						FROM TB_TAKEIN_CODE F1
					  WHERE ITEM_DETAIL LIKE CONCAT('%',#{itemDetail},'%')
	  					AND CUS_ITEM_CODE LIKE CONCAT('%',#{cusItemCode},'%')
	  					AND USER_ID = #{userId}
	  					AND ORG_STATION LIKE CONCAT('%',#{orgStation},'%')
	  					AND APPV_YN LIKE CONCAT('%',#{appvYn},'%')
	  					AND USE_YN = #{useYn}
					 ) M1
			WHERE M1.ROWNUM BETWEEN #{paging.boardStart} and #{paging.boardEnd} 
			order by M1.ROWNUM;
	</select>
	
	<select id="selectTakeInCode" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TakeinInfoVO">
		SELECT 
				ISNULL(TAKE_IN_CODE,'') AS TAKE_IN_CODE ,
				ISNULL(ORG_STATION,'') AS ORG_STATION ,
				ISNULL(USER_ID,'') AS USER_ID ,
				ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE ,
				ISNULL(HS_CODE,'') AS HS_CODE ,
				ISNULL(BRAND,'') AS BRAND ,
				ISNULL(ITEM_DETAIL,'') AS ITEM_DETAIL ,
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL ,
				ISNULL(ITEM_OPTION,'') AS ITEM_OPTION ,
				ISNULL(UNIT_VALUE,'') AS UNIT_VALUE ,
				ISNULL(UNIT_CURRENCY,'') AS UNIT_CURRENCY ,
				ISNULL(WTA,'') AS WTA ,
				ISNULL(WTC,'') AS WTC ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(QTY_UNIT,'') AS QTY_UNIT ,
				ISNULL(ITEM_URL,'') AS ITEM_URL ,
				ISNULL(ITEM_IMG_URL,'') AS ITEM_IMG_URL ,
				ISNULL(ITEM_METERIAL,'') AS ITEM_METERIAL ,
				ISNULL(ITEM_DIV,'') AS ITEM_DIV ,
				ISNULL(MAKE_CNTRY,'') AS MAKE_CNTRY ,
				ISNULL(MAKE_COM,'') AS MAKE_COM ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(W_DATE,'') AS W_DATE ,
				ISNULL(USE_YN,'') AS USE_YN ,
				ISNULL(APPV_YN,'') AS APPV_YN ,
				ISNULL(ITEM_COLOR,'') AS ITEM_COLOR ,
				ISNULL(ITEM_SIZE ,'') AS ITEM_SIZE  
          FROM TB_TAKEIN_CODE F1
         WHERE TAKE_IN_CODE = #{takeInCode}
AND USER_ID = #{userId}
	</select>
	
	<select id="selectOrgStation" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.OrgStationVO">
		SELECT ISNULL(STATION_CODE,'') AS STATION_CODE,
			   ISNULL(STATION_NAME,'') AS STATION_NAME,
       		   ISNULL(STATION_ADDR,'') AS STATION_ADDR, 
       		   ISNULL(STATION_TEL,'') AS STATION_TEL,
       		   ISNULL(NATION_CODE,'') AS NATION_CODE,
       		   ISNULL(NATION_NAME,'') AS NATION_NAME
		  FROM TB_STATION 
		 WHERE NATION_CODE IN (SELECT ORG_NATION FROM TB_USER_TRANS_COM WHERE USER_ID = #{userId})
	</select>
	
	<select id="insertUserTakeinInfo" parameterType="hashMap" resultType="hashMap" statementType="CALLABLE">
		DECLARE
		@ORG_STATION NVARCHAR(3),
		@USER_ID  NVARCHAR(50),
		@CUS_ITEM_CODE NVARCHAR(50) ,
		@HS_CODE  NVARCHAR(70) ,
		@ITEM_BARCODE NVARCHAR(100),
		@BRAND NVARCHAR(100),
		@ITEM_DETAIL NVARCHAR(300),
		@NATIVE_ITEM_DETAIL NVARCHAR(300),
		@ITEM_OPTION NVARCHAR(300),
		@UNIT_VALUE FLOAT,
		@UNIT_CURRENCY NVARCHAR(10) ,
		@WTA NVARCHAR(300),
		@WTC NVARCHAR(300),
		@WT_UNIT  NVARCHAR(10),
		@QTY_UNIT NVARCHAR(10),
		@ITEM_URL NVARCHAR(500),
		@ITEM_IMG_URL  NVARCHAR(500),
		@ITEM_METERIAL NVARCHAR(50),
		@ITEM_DIV NVARCHAR(100),
		@MAKE_CNTRY  NVARCHAR(100),
		@MAKE_COM NVARCHAR(100),
		@ITEM_COLOR NVARCHAR(100),
		@ITEM_SIZE NVARCHAR(100),
		@W_USER_ID NVARCHAR(100),
		@W_USER_IP NVARCHAR(100),
		@RST_STATUS NVARCHAR(10),
		@RST_CODE NVARCHAR(10),
		@RST_MSG NVARCHAR(100)


		SET @ORG_STATION=#{orgStation}
		SET @USER_ID=#{userId}
		SET @CUS_ITEM_CODE=#{cusItemCode}
		SET @HS_CODE=#{hsCode}
		SET @ITEM_BARCODE = #{itemBarcode}
		SET @BRAND=#{brand}
		SET @ITEM_DETAIL=#{itemDetail}
		SET @NATIVE_ITEM_DETAIL=#{nativeItemDetail}
		SET @ITEM_OPTION = #{itemOption}
		SET @UNIT_VALUE=#{unitValue}
		SET @UNIT_CURRENCY=#{unitCurrency}
		SET @WTA=#{wta}
		SET @WTC=#{wtc}
		SET @WT_UNIT=#{wtUnit}
		SET @QTY_UNIT=#{qtyUnit}
		SET @ITEM_URL=#{itemUrl}
		SET @ITEM_IMG_URL=#{itemImgUrl}
		SET @ITEM_METERIAL=#{itemMeterial}
		SET @ITEM_DIV=#{itemDiv}
		SET @MAKE_CNTRY=#{makeCntry}
		SET @MAKE_COM=#{makeCom}
		SET @W_USER_ID=#{wUserId}
		SET @W_USER_IP=#{wUserIp}
		SET @ITEM_COLOR= #{itemColor}
		SET @ITEM_SIZE=#{itemSize}

		EXEC SP_TAKEIN_CODE_IN
		@ORG_STATION,
		@USER_ID,
		@CUS_ITEM_CODE,
		@HS_CODE,
		@ITEM_BARCODE,
		@BRAND,
		@ITEM_DETAIL,
		@NATIVE_ITEM_DETAIL,
		@ITEM_OPTION,
		@UNIT_VALUE,
		@UNIT_CURRENCY,
		@WTA,
		@WTC,
		@WT_UNIT,
		@QTY_UNIT,
		@ITEM_URL,
		@ITEM_IMG_URL,
		@ITEM_METERIAL,
		@ITEM_DIV,
		@MAKE_CNTRY,
		@MAKE_COM,
		@ITEM_COLOR,
		@ITEM_SIZE,
		@W_USER_ID,
		@W_USER_IP,
		@RST_STATUS OUTPUT ,
		@RST_CODE OUTPUT ,
		@RST_MSG OUTPUT 
		
		SELECT @RST_STATUS AS rstStatus , @RST_MSG as rstMsg ;
	</select>
	

	<select id="updateUserTakeinInfo" parameterType="hashMap" resultType="hashMap" statementType="CALLABLE">
		DECLARE
		@TAKE_IN_CODE        NVARCHAR(50) ,
		@ORG_STATION         NVARCHAR(3)  ,
		@USER_ID             NVARCHAR(50) ,
		@CUS_ITEM_CODE       NVARCHAR(50) ,
		@HS_CODE             NVARCHAR(70) ,
		@ITEM_BARCODE        NVARCHAR(100),
		@BRAND               NVARCHAR(100),
		@ITEM_DETAIL         NVARCHAR(300),
		@NATIVE_ITEM_DETAIL  NVARCHAR(300),
		@ITEM_OPTION         NVARCHAR(300),
		@UNIT_VALUE          FLOAT        ,
		@UNIT_CURRENCY       NVARCHAR(10) ,
		@WTA                 NVARCHAR(300),
		@WTC                 NVARCHAR(300),
		@WT_UNIT             NVARCHAR(10) ,
		@QTY_UNIT            NVARCHAR(10) ,
		@ITEM_URL            NVARCHAR(500),
		@ITEM_IMG_URL        NVARCHAR(500),
		@ITEM_METERIAL       NVARCHAR(50) ,
		@ITEM_DIV            NVARCHAR(100),
		@MAKE_CNTRY          NVARCHAR(100),
		@MAKE_COM            NVARCHAR(100),
		@USE_YN              NVARCHAR(1),
		@APPV_YN             NVARCHAR(1),
		@ITEM_COLOR          NVARCHAR(100),
		@ITEM_SIZE           NVARCHAR(100),
		@W_USER_ID           NVARCHAR(100),
		@W_USER_IP           NVARCHAR(100),
		@RST_STATUS          NVARCHAR(10),
		@RST_CODE            NVARCHAR(10),
		@RST_MSG             NVARCHAR(100)   
		 
		SET @TAKE_IN_CODE=#{takeInCode} 
		SET @ORG_STATION=#{orgStation}
		SET @USER_ID=#{userId}
		SET @CUS_ITEM_CODE=#{cusItemCode}
		SET @HS_CODE=#{hsCode}
		SET @ITEM_BARCODE =#{itemBarcode}
		SET @BRAND=#{brand}
		SET @ITEM_DETAIL=#{itemDetail}
		SET @NATIVE_ITEM_DETAIL=#{nativeItemDetail}
		SET @ITEM_OPTION = #{itemOption}
		SET @UNIT_VALUE=#{unitValue}
		SET @UNIT_CURRENCY=#{unitCurrency}
		SET @WTA=#{wta}
		SET @WTC=#{wtc}
		SET @WT_UNIT=#{wtUnit}
		SET @QTY_UNIT=#{qtyUnit}
		SET @ITEM_URL=#{itemUrl}
		SET @ITEM_IMG_URL=#{itemImgUrl}
		SET @ITEM_METERIAL=#{itemMeterial}
		SET @ITEM_DIV=#{itemDiv}
		SET @MAKE_CNTRY=#{makeCntry}
		SET @MAKE_COM=#{makeCom}
		SET @USE_YN=#{useYn} 
		SET @APPV_YN=#{appvYn}
		SET @ITEM_COLOR =#{itemColor}
		SET @ITEM_SIZE =#{itemSize}
		SET @W_USER_ID=#{wUserId}
		SET @W_USER_IP=#{wUserIp}

		EXEC SP_TAKEIN_CODE_UP
		@TAKE_IN_CODE,
		@ORG_STATION,
		@USER_ID,
		@CUS_ITEM_CODE,
		@HS_CODE,
		@ITEM_BARCODE,
		@BRAND,
		@ITEM_DETAIL,
		@NATIVE_ITEM_DETAIL,
		@ITEM_OPTION ,
		@UNIT_VALUE,
		@UNIT_CURRENCY,
		@WTA,
		@WTC,
		@WT_UNIT,
		@QTY_UNIT,
		@ITEM_URL,
		@ITEM_IMG_URL,
		@ITEM_METERIAL,
		@ITEM_DIV,
		@MAKE_CNTRY,
		@MAKE_COM,
		@USE_YN,
		@APPV_YN,
		@ITEM_COLOR,
		@ITEM_SIZE,
		@W_USER_ID,
		@W_USER_IP,
		@RST_STATUS OUTPUT,
		@RST_CODE OUTPUT,
		@RST_MSG OUTPUT 
		
		SELECT @RST_STATUS AS rstStatus , @RST_MSG as rstMsg ;
	</select>
	
	<select id="selectUserTmpTakeInInfo" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinCodeVO">
		SELECT  IDX ,
		        ISNULL(ORG_STATION,'') AS ORG_STATION ,
		        ISNULL((SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = F1.ORG_STATION),'') as ORG_STATION_NAME,
				ISNULL(USER_ID,'') AS USER_ID ,
				ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE ,
				ISNULL(HS_CODE,'') AS HS_CODE ,
				ISNULL(BRAND,'') AS BRAND ,
				ISNULL(ITEM_DETAIL,'') AS ITEM_DETAIL ,
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL ,
				ISNULL(ITEM_OPTION,'') AS ITEM_OPTION ,
				ISNULL(UNIT_VALUE,'') AS UNIT_VALUE ,
				ISNULL(UNIT_CURRENCY,'') AS UNIT_CURRENCY ,
				ISNULL(WTA,'') AS WTA ,
				ISNULL(WTC,'') AS WTC ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(QTY_UNIT,'') AS QTY_UNIT ,
				ISNULL(ITEM_URL,'') AS ITEM_URL ,
				ISNULL(ITEM_IMG_URL,'') AS ITEM_IMG_URL ,
				ISNULL(ITEM_METERIAL,'') AS ITEM_METERIAL ,
				ISNULL(ITEM_DIV,'') AS ITEM_DIV ,
				ISNULL(MAKE_CNTRY,'') AS MAKE_CNTRY ,
				ISNULL(MAKE_COM,'') AS MAKE_COM ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(W_DATE,'') AS W_DATE ,
				(SELECT CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END FROM TB_TAKEIN_CODE WHERE CUS_ITEM_CODE = F1.CUS_ITEM_CODE AND ORG_STATION = F1.ORG_STATION AND USER_ID = F1.USER_ID) ALREADY_YN ,
				(SELECT CASE WHEN COUNT(*) = 1 THEN 'N' ELSE 'Y' END FROM TMP_TAKEIN_CODE WHERE CUS_ITEM_CODE = F1.CUS_ITEM_CODE AND ORG_STATION = F1.ORG_STATION AND USER_ID = F1.USER_ID) OVERLAP_YN
  		  FROM TMP_TAKEIN_CODE F1
  		 WHERE USER_ID = #{userId}
	</select>
	
	
	<delete id="deleteUserTakeinCode">
		DELETE FROM TMP_TAKEIN_CODE WHERE IDX = #{idx}
	</delete>
	
	
	<insert id="insertTmpTakeinInfo" parameterType="com.example.temp.member.vo.takein.TmpTakeinCodeVO">
INSERT INTO TMP_TAKEIN_CODE( ORG_STATION,
     USER_ID,
     CUS_ITEM_CODE,
     HS_CODE,
     BRAND,
     ITEM_DETAIL,
     NATIVE_ITEM_DETAIL,
     ITEM_OPTION,
     UNIT_VALUE,
     UNIT_CURRENCY,
	 WTA,
     WTC,
     WT_UNIT,
     QTY_UNIT,
     ITEM_URL,
     ITEM_IMG_URL,
     ITEM_METERIAL,
     ITEM_DIV,
     MAKE_CNTRY,
     MAKE_COM,
     W_USER_ID,
     W_USER_IP,
     W_DATE,
     USE_YN,
     APPV_YN,
     ITEM_COLOR ,
     ITEM_SIZE
    )VALUES(#{orgStation},
     #{userId},
     #{cusItemCode},
     #{hsCode},
     #{brand},
     #{itemDetail},
     #{nativeItemDetail},
     #{itemOption},
     #{unitValue},
     #{unitCurrency},
     #{wta},
     #{wtc},
     #{wtUnit},
     #{qtyUnit},
     #{itemUrl},
		  #{itemImgUrl},
		  #{itemMeterial},
		  #{itemDiv},
		  #{makeCntry},
		  #{makeCom},
		  #{wUserId},
		  #{wUserIp},
		  #{wDate},
		  #{useYn},
		  #{appvYn},
		  #{itemColor},
		  #{itemSize}
  );
	</insert>
	
<select id="selectOrgStationCheck" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.OrgStationVO">
	SELECT STATION_CODE  , STATION_NAME FROM TB_STATION 
  WHERE STATION_NAME LIKE CONCAT('%',#{orgStation},'%') 
     OR STATION_CODE LIKE CONCAT('%',#{orgStation},'%') 
</select>

<select id="selectTmpTakeinCode" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TmpTakeinCodeVO">
		SELECT 
				ISNULL(ORG_STATION,'') AS ORG_STATION ,
				ISNULL(USER_ID,'') AS USER_ID ,
				ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE ,
				ISNULL(HS_CODE,'') AS HS_CODE ,
				ISNULL(BRAND,'') AS BRAND ,
				ISNULL(ITEM_DETAIL,'') AS ITEM_DETAIL ,
				ISNULL(NATIVE_ITEM_DETAIL,'') AS NATIVE_ITEM_DETAIL ,
				ISNULL(ITEM_OPTION,'') AS ITEM_OPTION ,
				ISNULL(UNIT_VALUE,'') AS UNIT_VALUE ,
				ISNULL(UNIT_CURRENCY,'') AS UNIT_CURRENCY ,
				ISNULL(WTA,'') AS WTA ,
				ISNULL(WTC,'') AS WTC ,
				ISNULL(WT_UNIT,'') AS WT_UNIT ,
				ISNULL(QTY_UNIT,'') AS QTY_UNIT ,
				ISNULL(ITEM_URL,'') AS ITEM_URL ,
				ISNULL(ITEM_IMG_URL,'') AS ITEM_IMG_URL ,
				ISNULL(ITEM_METERIAL,'') AS ITEM_METERIAL ,
				ISNULL(ITEM_DIV,'') AS ITEM_DIV ,
				ISNULL(MAKE_CNTRY,'') AS MAKE_CNTRY ,
				ISNULL(MAKE_COM,'') AS MAKE_COM ,
				ISNULL(W_USER_ID,'') AS W_USER_ID ,
				ISNULL(W_USER_IP,'') AS W_USER_IP ,
				ISNULL(W_DATE,'') AS W_DATE ,
				ISNULL(USE_YN,'') AS USE_YN ,
				ISNULL(APPV_YN,'') AS APPV_YN ,
				ISNULL(ITEM_COLOR,'') AS ITEM_COLOR ,
				ISNULL(ITEM_SIZE,'') AS ITEM_SIZE 
		  FROM TMP_TAKEIN_CODE
		  WHERE USER_ID = #{userId}
		    and IDX = #{idx} 
</select>

<delete id="delteUserTmpTakeinCode" parameterType="hashMap" >
	DELETE FROM TMP_TAKEIN_CODE
     WHERE USER_ID = #{userId}
	   AND IDX = #{idx} 
</delete>

	<select id="selectTakeinUserStockListCnt" parameterType="hashMap" resultType="integer">
		
		SELECT COUNT(*) FROM (
					SELECT  ROW_NUMBER() OVER(ORDER BY WH_IN_DATE DESC , TAKE_IN_CODE DESC) ROWNUM,
							ISNULL(TAKE_IN_CODE,'') AS TAKE_IN_CODE,
							ISNULL(WHCNT,'') AS WHCNT,
							ISNULL(F2.GROUP_IDX,'') AS GROUP_IDX,
							ISNULL(F2.ORG_STATION,'') AS ORG_STATION,
							ISNULL(F2.USER_ID,'') AS USER_ID,
							ISNULL(F2.WH_IN_DATE,'') AS WH_IN_DATE,
							ISNULL(F2.IN_SPECTOR,'') AS IN_SPECTOR,
							ISNULL(F2.USE_YN,'') AS USE_YN,
							ISNULL(F2.CUS_INV_NO,'') AS CUS_INV_NO,
							ISNULL(F2.CUS_SUPPLIER,'') AS CUS_SUPPLIER,
							ISNULL(F2.CUS_SUPPLIER_ADDR,'') AS CUS_SUPPLIER_ADDR,
							ISNULL(F2.CUS_SUPPLIER_TEL,'') AS CUS_SUPPLIER_TEL,
							ISNULL(F2.CUS_OUT_NO,'') AS CUS_OUT_NO,
							ISNULL(F2.REMARK,'') AS REMARK,
							ISNULL(F2.W_USER_ID,'') AS W_USER_ID,
							ISNULL(F2.W_USER_IP,'') AS W_USER_IP,
							ISNULL(F2.W_DATE,'') AS W_DATE
					 FROM (SELECT GROUP_IDX , 
					   ORG_STATION ,
					   TAKE_IN_CODE , 
					   CUS_ITEM_CODE , 
					   USER_ID ,
					   COUNT(*) AS WHCNT 
					        FROM  TB_STOCK GROUP BY GROUP_IDX , ORG_STATION , TAKE_IN_CODE ,CUS_ITEM_CODE, USER_ID) F1  ,
					      TB_TAKEIN_ITEM F2
					 WHERE F1.GROUP_IDX = F2.GROUP_IDX
					   AND F1.TAKE_IN_CODE LIKE CONCAT('%',#{takeInCode},'%')
					   AND F1.USER_ID LIKE CONCAT('%',#{userId},'%')
					   AND F1.CUS_ITEM_CODE LIKE CONCAT('%',#{cusItemCode},'%')) M1
	</select>
	<select id="selectTakeinUserStockList" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TakeinUserStockListVO">
		
		SELECT * FROM (
					SELECT  ROW_NUMBER() OVER(ORDER BY WH_IN_DATE DESC , TAKE_IN_CODE DESC) ROWNUM,
							ISNULL(TAKE_IN_CODE,'') AS TAKE_IN_CODE,
							ISNULL((SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = F1.ORG_STATION),'') as ORG_STATION_NAME,
							ISNULL(CUS_ITEM_CODE,'') AS CUS_ITEM_CODE,
							ISNULL((SELECT HS_CODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE),'') AS HS_CODE,
							ISNULL((SELECT ITEM_DETAIL FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F2.USER_ID AND ORG_STATION = F2.ORG_STATION),'') as ITEM_DETAIL, 
							ISNULL((SELECT ITEM_OPTION FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F2.USER_ID AND ORG_STATION = F2.ORG_STATION),'') as ITEM_OPTION,
							ISNULL((SELECT QTY_UNIT FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F2.USER_ID AND ORG_STATION = F2.ORG_STATION),'') as QTY_UNIT,
							ISNULL(WHCNT,'') AS WH_IN_CNT,
							(SELECT COUNT(*) FROM TB_STOCK WHERE GROUP_IDX = F1.GROUP_IDX AND TAKE_IN_CODE = F1.TAKE_IN_CODE AND ISNULL(OUT_NNO,'') != '' AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS WH_OUT_CNT,
							ISNULL(F2.GROUP_IDX,'') AS GROUP_IDX,
							ISNULL(F2.ORG_STATION,'') AS ORG_STATION,
							ISNULL(F2.USER_ID,'') AS USER_ID,
							ISNULL(F2.WH_IN_DATE,'') AS WH_IN_DATE,
							ISNULL(F2.IN_SPECTOR,'') AS IN_SPECTOR,
							ISNULL(F2.USE_YN,'') AS USE_YN,
							ISNULL(F2.CUS_INV_NO,'') AS CUS_INV_NO,
							ISNULL(F2.CUS_SUPPLIER,'') AS CUS_SUPPLIER,
							ISNULL(F2.CUS_SUPPLIER_ADDR,'') AS CUS_SUPPLIER_ADDR,
							ISNULL(F2.CUS_SUPPLIER_TEL,'') AS CUS_SUPPLIER_TEL,
							ISNULL(F2.CUS_OUT_NO,'') AS CUS_OUT_NO,
							ISNULL(F2.REMARK,'') AS REMARK,
							ISNULL(F2.W_USER_ID,'') AS W_USER_ID,
							ISNULL(F2.W_USER_IP,'') AS W_USER_IP,
							ISNULL(F2.W_DATE,'') AS W_DATE,
							CASE
								WHEN ISNULL(F2.MN_DATE,'') = '' THEN ''
								ELSE CONCAT(SUBSTRING(F2.MN_DATE,1,4),'-',SUBSTRING(F2.MN_DATE,5,2),'-',SUBSTRING(F2.MN_DATE,7,2))
							END MN_DATE
					 FROM (SELECT GROUP_IDX , 
					   ORG_STATION ,
					   TAKE_IN_CODE , 
					   CUS_ITEM_CODE , 
					   USER_ID ,
					   COUNT(*) AS WHCNT 
					        FROM  TB_STOCK GROUP BY GROUP_IDX , ORG_STATION , TAKE_IN_CODE ,CUS_ITEM_CODE, USER_ID) F1  ,
					      TB_TAKEIN_ITEM F2
					 WHERE F1.GROUP_IDX = F2.GROUP_IDX
					   AND F1.TAKE_IN_CODE LIKE CONCAT('%',#{takeInCode},'%')
					   AND F1.USER_ID LIKE CONCAT('%',#{userId},'%')
					   AND F1.CUS_ITEM_CODE LIKE CONCAT('%',#{cusItemCode},'%')) M1
					ORDER BY ROWNUM
	</select>
	
	
	<select id="selectUserTransCom" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.UserTransVO">
			SELECT DISTINCT 
			       TRANS_CODE ,
			       (SELECT TRANS_NAME FROM TB_TRANS_COM WHERE TRANS_CODE = F1.TRANS_CODE) TRANS_NAME,
			       NATION_CODE
			 FROM TB_USER_TRANS_COM F1 WHERE USER_ID = #{userId}
	</select>

	<select id="selectTakeInUserStockOutList" parameterType="hashMap" resultType="com.example.temp.member.vo.takein.TakeInUserStockOutVO">
		SELECT USER_ID ,
    		   (SELECT WH_IN_DATE FROM TB_TAKEIN_ITEM WHERE GROUP_IDX  = F1.GROUP_IDX AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) AS WH_IN_DATE,
       		   (SELECT CUS_ITEM_CODE WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) CUS_ITEM_CODE,
		       ISNULL(RACK_CODE,'') AS RACK_CODE,
		       STOCK_NO , 
		       (SELECT ITEM_DETAIL FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND ORG_STATION = F1.ORG_STATION AND USER_ID = F1.USER_ID) ITEM_DETAIL,
		       ISNULL((SELECT CONVERT(VARCHAR,W_DATE,112) FROM TB_HAWB WHERE NNO = F1.OUT_NNO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION),'') OUT_DATE, 
		       ISNULL((SELECT HAWB_NO FROM TB_HAWB WHERE NNO = F1.OUT_NNO AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION),ISNULL(OUT_NNO,'')) OUT_HAWB, 
		       ISNULL(REMARK,'') AS REMARK, 
		       GROUP_IDX ,
		       ISNULL((SELECT MN_DATE FROM TB_TAKEIN_ITEM WHERE GROUP_IDX = F1.GROUP_IDX AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION),'') AS MN_DATE
		  FROM TB_STOCK F1
		WHERE STOCK_TYEP= 'TAKE_IN'
		  AND ORG_STATION = #{orgStation}
		  AND USER_ID = #{userId}
		  AND GROUP_IDX = #{groupIdx}
		 ORDER BY OUT_NNO DESC , STOCK_NO; 
	</select>
	
	<select id="selectUserTakeinStockInCnt" parameterType="hashMap" resultType="integer">

		DECLARE @ORG_STATION NVARCHAR(3)
		DECLARE @USER_ID NVARCHAR(50)
		DECLARE @CUS_ITEM_CODE NVARCHAR(50)
		DECLARE @ITEM_DETAIL NVARCHAR(50)
		
		SET @USER_ID = #{userId}
		SET @ORG_STATION = #{station}
		SET @CUS_ITEM_CODE = #{cusItemCode}
		SET @ITEM_DETAIL = #{itemDetail}
		
		SELECT COUNT(*) FROM (
		SELECT *
		FROM ( SELECT ORG_STATION ,
		              USER_ID ,
		              TAKE_IN_CODE, 
		              WH_IN_DATE ,
		              ISNULL((SELECT WH_IN_TYPE FROM TB_TAKEIN_ITEM WHERE GROUP_IDX = F1.GROUP_IDX AND  USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION),'A') WH_IN_TYPE
		         FROM TB_STOCK F1
		         WHERE TAKE_IN_CODE IN (SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE  ITEM_DETAIL LIKE CONCAT('%',@ITEM_DETAIL,'%') AND USER_ID = @USER_ID AND ORG_STATION = F1.ORG_STATION)
		           AND TAKE_IN_CODE LIKE CONCAT('%',(SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE  CUS_ITEM_CODE = @CUS_ITEM_CODE AND USER_ID = @USER_ID AND ORG_STATION = F1.ORG_STATION),'%')
		           AND USER_ID LIKE CONCAT('%',@USER_ID,'%')
		           AND ORG_STATION LIKE  CONCAT('%',@ORG_STATION,'%')
		          
		     ) M1
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE , WH_IN_DATE, WH_IN_TYPE
		) M2
		
	</select>
	
	
	<select id="selectUserTakeinStockInMonthCnt" parameterType="hashMap" resultType="integer">
			DECLARE @ORG_STATION NVARCHAR(3)
			DECLARE @USER_ID NVARCHAR(50)
			DECLARE @CUS_ITEM_CODE NVARCHAR(50)
			DECLARE @ITEM_DETAIL NVARCHAR(50)
			DECLARE @TAKE_IN_CODE NVARCHAR(50)
			
			SET @USER_ID = #{userId}
			SET @ORG_STATION = #{station}
			SET @CUS_ITEM_CODE = #{cusItemCode}
			SET @ITEM_DETAIL = #{itemDetail}


			SELECT COUNT(*) 
			FROM (
			SELECT SUBSTRING(WH_IN_DATE,1,6) AS STOCK_MONTH,
			       ORG_STATION , 
			       USER_ID,
			       TAKE_IN_CODE 
			  FROM TB_STOCK 
			 WHERE TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE CUS_ITEM_CODE LIKE CONCAT('%',@CUS_ITEM_CODE,'%') ) 
			   AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE ITEM_DETAIL LIKE CONCAT('%',@ITEM_DETAIL,'%') )
			   AND USER_ID = @USER_ID
			   AND ORG_STATION LIKE CONCAT('%','','%')
			GROUP BY ORG_STATION , 
			         USER_ID,
			         WH_IN_DATE , 
			         TAKE_IN_CODE
			UNION 
			SELECT SUBSTRING(dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE'),1,6)  , 
			       ORG_STATION , 
			       USER_ID,
			       TAKE_IN_CODE 
			  FROM TB_STOCK F1
			 WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != ''
			   AND ISNULL(OUT_NNO,'') != ''
			   AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE CUS_ITEM_CODE LIKE CONCAT('%',@CUS_ITEM_CODE,'%') AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION ) 
			   AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE  FROM TB_TAKEIN_CODE WHERE ITEM_DETAIL LIKE CONCAT('%',@ITEM_DETAIL,'%') AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION)
			   AND USER_ID = @USER_ID
			   AND ORG_STATION LIKE CONCAT('%','','%')
			GROUP BY ORG_STATION , 
			         USER_ID,
			         dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') , 
			         TAKE_IN_CODE
			) M1

	</select>
	
	<select id="selectUserTakeinStockInMonth" parameterType="hashMap" resultType="hashMap">
		DECLARE @ORG_STATION NVARCHAR(3)
		DECLARE @USER_ID NVARCHAR(50)
		DECLARE @CUS_ITEM_CODE NVARCHAR(50)
		DECLARE @ITEM_DETAIL NVARCHAR(50)
		DECLARE @TAKE_IN_CODE NVARCHAR(50)
		
		SET @USER_ID = #{userId}
		SET @ORG_STATION = #{station}
		SET @CUS_ITEM_CODE = #{cusItemCode}
		SET @ITEM_DETAIL = #{itemDetail}


		SELECT * FROM (
						SELECT ROW_NUMBER() OVER(ORDER BY STOCK_MONTH DESC,TAKE_IN_CODE) ROWNUM , 
							   (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = ORG_STATION) AS stationName ,
							   (SELECT CUS_ITEM_CODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) cusItemCode,
							   (SELECT ITEM_BARCODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) itemBarCode,
							   (SELECT ITEM_DETAIL FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) itemDetail,
						       STOCK_MONTH as stockMonth , 
						       TAKE_IN_CODE,
						       (SELECT COUNT(*) FROM TB_STOCK F1
								 WHERE (SELECT WH_IN_TYPE FROM TB_TAKEIN_ITEM WHERE GROUP_IDX = F1.GROUP_IDX AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) = 'NOMAL'
								   AND SUBSTRING(WH_IN_DATE,1,6) = M1.STOCK_MONTH 
								   AND TAKE_IN_CODE = M1.TAKE_IN_CODE
								   AND USER_ID = @USER_ID
								   AND ORG_STATION = M1.ORG_STATION) nomalInCnt ,
								(SELECT COUNT(*) FROM TB_STOCK F1
							     WHERE (SELECT WH_IN_TYPE FROM TB_TAKEIN_ITEM WHERE GROUP_IDX = F1.GROUP_IDX AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) = 'RETURNIN'
							       AND SUBSTRING(WH_IN_DATE,1,6) = M1.STOCK_MONTH 
							       AND TAKE_IN_CODE = M1.TAKE_IN_CODE
							       AND USER_ID = @USER_ID
								   AND ORG_STATION = M1.ORG_STATION) returnInCnt,
								 (SELECT COUNT(*) FROM TB_STOCK A1
							      WHERE SUBSTRING(dbo.FN_STOCK_OUT_INFO(A1.OUT_NNO,@USER_ID, A1.ORG_STATION,'OUT_DATE'),1,6) = M1.STOCK_MONTH
							        AND TAKE_IN_CODE = M1.TAKE_IN_CODE
							        AND USER_ID = @USER_ID
							        AND ORG_STATION = M1.ORG_STATION) outCnt,
							      (SELECT COUNT(*) FROM TB_STOCK F1
										     WHERE SUBSTRING(WH_IN_DATE,1,6)  <![CDATA[<=]]> M1.STOCK_MONTH 
										       AND TAKE_IN_CODE = M1.TAKE_IN_CODE
										       AND USER_ID = @USER_ID
										       AND ORG_STATION = M1.ORG_STATION) -
								   (SELECT COUNT(*) FROM VI_TAKEIN_STOCK_OUT_INFO 
								     WHERE SUBSTRING(OUT_DATE,1,6)  <![CDATA[<=]]> M1.STOCK_MONTH
								       AND dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != ''
								       AND TAKE_IN_CODE = M1.TAKE_IN_CODE
								       AND USER_ID = @USER_ID
								       AND ORG_STATION =M1.ORG_STATION) stockCnt   
						FROM (
						SELECT SUBSTRING(WH_IN_DATE,1,6) AS STOCK_MONTH,
						       ORG_STATION , 
						       USER_ID,
						       TAKE_IN_CODE 
						  FROM TB_STOCK 
						 WHERE USER_ID = @USER_ID
						    AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE CUS_ITEM_CODE LIKE CONCAT('%',@CUS_ITEM_CODE,'%') ) 
						   AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE ITEM_DETAIL LIKE CONCAT('%',@ITEM_DETAIL,'%') )
						 AND ORG_STATION LIKE CONCAT('%',@ORG_STATION,'%')
						GROUP BY ORG_STATION , 
						         USER_ID,
						         WH_IN_DATE , 
						         TAKE_IN_CODE
						UNION 
						SELECT SUBSTRING(dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE'),1,6)  , 
						       ORG_STATION , 
						       USER_ID,
						       TAKE_IN_CODE 
						  FROM TB_STOCK F1
						 WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != ''
						   AND ISNULL(OUT_NNO,'') != '' 
						   AND TAKE_IN_CODE IN ( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE CUS_ITEM_CODE LIKE CONCAT('%',@CUS_ITEM_CODE,'%') 
						   AND USER_ID  = F1.USER_ID AND ORG_STATION = F1.ORG_STATION ) 
						   AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE ITEM_DETAIL LIKE CONCAT('%',@ITEM_DETAIL,'%') AND USER_ID  = F1.USER_ID AND ORG_STATION = F1.ORG_STATION)
						   AND USER_ID = @USER_ID
						   AND ORG_STATION LIKE CONCAT('%',@ORG_STATION,'%')
						GROUP BY ORG_STATION , 
						         USER_ID,
						         dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') , 
						         TAKE_IN_CODE
						) M1
			) M2
			WHERE M2.ROWNUM BETWEEN #{paging.boardStart} and #{paging.boardEnd} 
	</select>
	
	<select id="selectUserTakeinStockInMonthExcel" parameterType="hashMap" resultType="hashMap">
	DECLARE @ORG_STATION NVARCHAR(3)
	DECLARE @USER_ID NVARCHAR(50)
	DECLARE @CUS_ITEM_CODE NVARCHAR(50)
	DECLARE @ITEM_DETAIL NVARCHAR(50)
	DECLARE @TAKE_IN_CODE NVARCHAR(50)
		
		SET @USER_ID = #{userId}
		SET @ORG_STATION = #{station}
		SET @CUS_ITEM_CODE = #{cusItemCode}
		SET @ITEM_DETAIL = #{itemDetail}

			SELECT ROW_NUMBER() OVER(ORDER BY STOCK_MONTH DESC,TAKE_IN_CODE) ROWNUM , 
				   (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = ORG_STATION) AS stationName ,
				   (SELECT CUS_ITEM_CODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) cusItemCode,
				   (SELECT ITEM_BARCODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) itemBarCode,
				   (SELECT ITEM_DETAIL FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) itemDetail,
			       STOCK_MONTH as stockMonth , 
			       TAKE_IN_CODE,
			       (SELECT COUNT(*) FROM TB_STOCK F1
					 WHERE (SELECT WH_IN_TYPE FROM TB_TAKEIN_ITEM WHERE GROUP_IDX = F1.GROUP_IDX AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) = 'NOMAL'
					   AND SUBSTRING(WH_IN_DATE,1,6) = M1.STOCK_MONTH 
					   AND TAKE_IN_CODE = M1.TAKE_IN_CODE
					   AND USER_ID = @USER_ID
					   AND ORG_STATION = M1.ORG_STATION) nomalInCnt ,
					(SELECT COUNT(*) FROM TB_STOCK F1
				     WHERE (SELECT WH_IN_TYPE FROM TB_TAKEIN_ITEM WHERE GROUP_IDX = F1.GROUP_IDX AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) = 'RETURNIN'
				       AND SUBSTRING(WH_IN_DATE,1,6) = M1.STOCK_MONTH 
				       AND TAKE_IN_CODE = M1.TAKE_IN_CODE
				       AND USER_ID = @USER_ID
					   AND ORG_STATION = M1.ORG_STATION) returnInCnt,
					 (SELECT COUNT(*) FROM TB_STOCK A1
				      WHERE SUBSTRING(dbo.FN_STOCK_OUT_INFO(A1.OUT_NNO,@USER_ID, A1.ORG_STATION,'OUT_DATE'),1,6) = M1.STOCK_MONTH
				        AND TAKE_IN_CODE = M1.TAKE_IN_CODE
				        AND USER_ID = @USER_ID
				        AND ORG_STATION = M1.ORG_STATION) outCnt,
				      (SELECT COUNT(*) FROM TB_STOCK F1
							     WHERE SUBSTRING(WH_IN_DATE,1,6)  <![CDATA[<=]]> M1.STOCK_MONTH 
							       AND TAKE_IN_CODE = M1.TAKE_IN_CODE
							       AND USER_ID = @USER_ID
							       AND ORG_STATION = M1.ORG_STATION) -
					   (SELECT COUNT(*) FROM VI_TAKEIN_STOCK_OUT_INFO 
					     WHERE SUBSTRING(OUT_DATE,1,6)  <![CDATA[<=]]> M1.STOCK_MONTH
					      AND dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != ''
					      AND TAKE_IN_CODE = M1.TAKE_IN_CODE
					      AND USER_ID = @USER_ID
					      AND ORG_STATION =M1.ORG_STATION) stockCnt   
			FROM (
			SELECT SUBSTRING(WH_IN_DATE,1,6) AS STOCK_MONTH,
			       ORG_STATION , 
			       USER_ID,
			       TAKE_IN_CODE 
			  FROM TB_STOCK 
			 WHERE USER_ID = @USER_ID
			    AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE LIKE CONCAT('%',@TAKE_IN_CODE,'%') ) 
			    AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE ITEM_DETAIL LIKE CONCAT('%',@ITEM_DETAIL,'%') )
			    AND ORG_STATION LIKE CONCAT('%','','%')
			GROUP BY ORG_STATION , 
			         USER_ID,
			         WH_IN_DATE , 
			         TAKE_IN_CODE
			UNION 
			SELECT SUBSTRING(dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE'),1,6)  , 
			       ORG_STATION , 
			       USER_ID,
			       TAKE_IN_CODE 
			  FROM TB_STOCK F1
			 WHERE ISNULL(OUT_NNO,'') != ''
			   AND dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != ''
			   AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE LIKE CONCAT('%',@TAKE_IN_CODE,'%') AND USER_ID  = F1.USER_ID AND ORG_STATION = F1.ORG_STATION ) 
			   AND TAKE_IN_CODE IN( SELECT TAKE_IN_CODE FROM TB_TAKEIN_CODE WHERE ITEM_DETAIL LIKE CONCAT('%',@ITEM_DETAIL,'%') AND USER_ID  = F1.USER_ID AND ORG_STATION = F1.ORG_STATION)
			   AND USER_ID = @USER_ID
			   AND ORG_STATION LIKE CONCAT('%','','%')
			GROUP BY ORG_STATION , 
			         USER_ID,
			         dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') , 
			         TAKE_IN_CODE
			) M1
		ORDER BY ORG_STATION , STOCK_MONTH DESC , TAKE_IN_CODE

	</select>

	<select id="selectStockStationList" parameterType="hashMap" resultType="hashMap">
		DECLARE @ORG_STATION NVARCHAR(3)
		DECLARE @USER_ID NVARCHAR(50)
		
		SET @USER_ID = #{userId}

		SELECT ORG_STATION AS orgStation ,
		       (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = ORG_STATION) AS stationName
		  FROM TB_STOCK 
		 WHERE USER_ID = @USER_ID
		  GROUP BY ORG_STATION
	</select>
	
	
	<select id="selectUserTakeinStockOutDayCnt" parameterType="hashMap" resultType="integer">
		DECLARE @FROM_DATE NVARCHAR(8),
        @TO_DATE NVARCHAR(8) ,
        @ORG_STATION NVARCHAR(3),
        @USER_ID NVARCHAR(50)

		SET @ORG_STATION = #{orgStation}
		SET @USER_ID = #{userId}
		SET @FROM_DATE = #{fromDate}      
		SET @TO_DATE = #{toDate}      
		
        SELECT COUNT(*) FROM (
			SELECT ROW_NUMBER() OVER( ORDER BY TAKE_IN_CODE) ROWNUM ,
			       (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = ORG_STATION) stationName,
			       TAKE_IN_CODE AS takeInCode ,
			       CUS_ITEM_CODE AS cusItemCode, 
			       ITEM_BARCODE as itemBarCode,
			       ITEM_DETAIL  as itemDetail,
			        (SELECT COUNT(*) FROM TB_STOCK 
			          WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  BETWEEN @FROM_DATE AND @TO_DATE
			            AND TAKE_IN_CODE = F1.TAKE_IN_CODE
			            AND USER_ID = F1.USER_ID
			            AND ORG_STATION = F1.ORG_STATION)  as outCnt,
			        (SELECT COUNT(*) FROM TB_STOCK 
			          WHERE ISNULL(OUT_NNO,'') = ''
			            AND TAKE_IN_CODE = F1.TAKE_IN_CODE
			            AND USER_ID = F1.USER_ID
			            AND ORG_STATION = F1.ORG_STATION) as stockCnt 
			  FROM TB_TAKEIN_CODE F1
			 WHERE USER_ID = @USER_ID
			   AND ORG_STATION like CONCAT('%',@ORG_STATION,'%')
			 ) M1
	</select>
	
	<select id="selectUserTakeinStockOutDay" parameterType="hashMap" resultType="hashMap">
		DECLARE @FROM_DATE NVARCHAR(8),
        @TO_DATE NVARCHAR(8) ,
        @ORG_STATION NVARCHAR(3),
        @USER_ID NVARCHAR(50)

		SET @ORG_STATION = #{orgStation}
		SET @USER_ID = #{userId}
		SET @FROM_DATE = #{fromDate}      
		SET @TO_DATE = #{toDate}      
		
        SELECT * FROM (
			SELECT ROW_NUMBER() OVER( ORDER BY TAKE_IN_CODE) ROWNUM ,
			       (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = ORG_STATION) stationName,
			       TAKE_IN_CODE AS takeInCode ,
			       CUS_ITEM_CODE AS cusItemCode, 
			       ITEM_BARCODE as itemBarCode,
			       ITEM_DETAIL  as itemDetail,
			        (SELECT COUNT(*) FROM TB_STOCK 
			          WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  BETWEEN @FROM_DATE AND @TO_DATE
			            AND TAKE_IN_CODE = F1.TAKE_IN_CODE
			            AND USER_ID = F1.USER_ID
			            AND ORG_STATION = F1.ORG_STATION)  as outCnt,
			       (SELECT COUNT(*) FROM TB_STOCK WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) -
			       (SELECT COUNT(*)
					  FROM TB_STOCK A1
					 WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')   <![CDATA[<=]]> @TO_DATE
					   AND dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != ''
					   AND ISNULL(OUT_NNO , '') != ''
					   AND TAKE_IN_CODE = F1.TAKE_IN_CODE
					   AND USER_ID = F1.USER_ID
					   AND ORG_STATION = F1.ORG_STATION) as stockCnt 
			  FROM TB_TAKEIN_CODE F1
			 WHERE USER_ID = @USER_ID
			   AND ORG_STATION like CONCAT('%',@ORG_STATION,'%')
			 ) M1
			 WHERE M1.ROWNUM BETWEEN #{paging.boardStart} and #{paging.boardEnd}
			 ORDER BY ROWNUM
	</select>
	
	
	<select id="takeinStockOutExcelDown" parameterType="hashMap" resultType="hashMap">
		DECLARE @FROM_DATE NVARCHAR(8),
        @TO_DATE NVARCHAR(8) ,
        @ORG_STATION NVARCHAR(3),
        @USER_ID NVARCHAR(50)

		SET @ORG_STATION = #{orgStation}
		SET @USER_ID = #{userId}
		SET @FROM_DATE = #{fromDate}      
		SET @TO_DATE = #{toDate}      
		
        SELECT * FROM (
			SELECT ROW_NUMBER() OVER( ORDER BY TAKE_IN_CODE) ROWNUM ,
			       (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = ORG_STATION) stationName,
			       TAKE_IN_CODE AS takeInCode ,
			       CUS_ITEM_CODE AS cusItemCode, 
			       ITEM_BARCODE as itemBarCode,
			       ITEM_DETAIL  as itemDetail,
			        (SELECT COUNT(*) FROM TB_STOCK 
			          WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  BETWEEN @FROM_DATE AND @TO_DATE
			            AND TAKE_IN_CODE = F1.TAKE_IN_CODE
			            AND USER_ID = F1.USER_ID
			            AND ORG_STATION = F1.ORG_STATION)  as outCnt,
			        (SELECT COUNT(*) FROM TB_STOCK WHERE TAKE_IN_CODE = F1.TAKE_IN_CODE AND USER_ID = F1.USER_ID AND ORG_STATION = F1.ORG_STATION) -
			       (SELECT COUNT(*)
					  FROM TB_STOCK A1
					 WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') <![CDATA[<=]]> @TO_DATE
					   AND dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != ''
					   AND ISNULL(OUT_NNO , '') != ''
					   AND TAKE_IN_CODE = F1.TAKE_IN_CODE
					   AND USER_ID = F1.USER_ID
					   AND ORG_STATION = F1.ORG_STATION) as stockCnt 
			  FROM TB_TAKEIN_CODE F1
			 WHERE USER_ID = @USER_ID
			   AND ORG_STATION like CONCAT('%',@ORG_STATION,'%')
			 ) M1
			 ORDER BY ROWNUM
	</select>
		
	
	<select id="selectInOutStockListCnt" parameterType="hashMap" resultType="integer">
    DECLARE @ORG_STATION NVARCHAR(3)
	DECLARE @USER_ID NVARCHAR(50)
	DECLARE @TAKE_IN_CODE NVARCHAR(50)
	DECLARE @FROM_DATE NVARCHAR(50)
	DECLARE @TO_DATE NVARCHAR(50)
	
	SET @ORG_STATION = #{orgStation}
	SET @USER_ID = #{userId}
	SET @FROM_DATE = #{fromDate}      
	SET @TO_DATE = #{toDate} 
	
	 SELECT COUNT(*) FROM (
	   SELECT TAKE_IN_CODE
		FROM ( 
		SELECT ORG_STATION ,
		       USER_ID ,
		       TAKE_IN_CODE, 
		       WH_IN_DATE AS STOCK_DATE,
		       COUNT(*) WH_IN_CNT ,
		       0 OUT_CNT
		 FROM TB_STOCK
		WHERE WH_IN_DATE  BETWEEN @FROM_DATE AND @TO_DATE
		  AND USER_ID = @USER_ID
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE  , WH_IN_DATE , GROUP_IDX
		UNION 
		SELECT ORG_STATION ,
		       USER_ID ,
		       TAKE_IN_CODE, 
			   dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  AS STOCK_DATE ,
		       0 WH_IN_CNT ,
		       COUNT(*)
		 FROM TB_STOCK
		WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  BETWEEN @FROM_DATE AND @TO_DATE 
		  AND ISNULL(OUT_NNO,'') != ''
		  AND USER_ID = @USER_ID
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE , dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') , GROUP_IDX
		) M1
		WHERE ORG_STATION LIKE CONCAT('%',@ORG_STATION,'%')
		  AND USER_ID LIKE CONCAT('%',@USER_ID,'%')
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE , STOCK_DATE
	) M2		
	</select>
	
	<select id="selectInOutStockList" parameterType="hashMap" resultType="hashMap">
		DECLARE @ORG_STATION NVARCHAR(3)
		DECLARE @USER_ID NVARCHAR(50)
		DECLARE @TAKE_IN_CODE NVARCHAR(50)
		DECLARE @FROM_DATE NVARCHAR(50)
		DECLARE @TO_DATE NVARCHAR(50)
		
		SET @ORG_STATION = #{orgStation}
		SET @USER_ID = #{userId}
		SET @FROM_DATE = #{fromDate}      
		SET @TO_DATE = #{toDate} 
		
		SELECT * FROM (
		SELECT ROW_NUMBER() OVER(ORDER BY STOCK_DATE DESC , TAKE_IN_CODE) AS ROWNUM ,
		       ORG_STATION as  orgStation,
		       (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = M1.ORG_STATION) as stationName ,  
		       USER_ID userId , 
		       TAKE_IN_CODE  takeInCode, 
		       (SELECT CUS_ITEM_CODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) cusItemCode ,
		       (SELECT ITEM_BARCODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) itemBarCode ,
		       (SELECT ITEM_DETAIL FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) itemDetail ,
		       STOCK_DATE  as stockDate , 
		       SUM(WH_IN_CNT) as whInCnt, 
		       SUM(OUT_CNT) as outCnt ,
		       (SELECT COUNT(*) FROM TB_STOCK WHERE WH_IN_DATE <![CDATA[<=]]>  M1.STOCK_DATE AND STOCK_TYEP = 'TAKE_IN' AND TAKE_IN_CODE = M1.TAKE_IN_CODE AND ORG_STATION = M1.ORG_STATION AND USER_ID = M1.USER_ID) -
		       (SELECT COUNT(*) FROM TB_STOCK 
		         WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') <![CDATA[<=]]> M1.STOCK_DATE
		         AND dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != '' 
		         AND STOCK_TYEP = 'TAKE_IN' AND ISNULL(OUT_NNO,'') != '' AND TAKE_IN_CODE = M1.TAKE_IN_CODE AND ORG_STATION = M1.ORG_STATION AND USER_ID = M1.USER_ID) stockCnt
		FROM ( 
		SELECT ORG_STATION ,
		       USER_ID ,
		       TAKE_IN_CODE, 
		       WH_IN_DATE AS STOCK_DATE,
		       COUNT(*) WH_IN_CNT ,
		       0 OUT_CNT
		 FROM TB_STOCK
		WHERE WH_IN_DATE  BETWEEN @FROM_DATE AND @TO_DATE
		  AND USER_ID = @USER_ID
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE  , WH_IN_DATE , GROUP_IDX
		UNION 
		SELECT ORG_STATION ,
		       USER_ID ,
		       TAKE_IN_CODE, 
			   dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  AS STOCK_DATE ,
		       0 WH_IN_CNT ,
		       COUNT(*)
		 FROM TB_STOCK
		WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  BETWEEN @FROM_DATE AND @TO_DATE 
		  AND ISNULL(OUT_NNO,'') != ''
		  AND USER_ID = @USER_ID
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE , dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') , GROUP_IDX
		) M1
		WHERE ORG_STATION LIKE CONCAT('%',@ORG_STATION,'%')
		  AND USER_ID LIKE CONCAT('%',@USER_ID,'%')
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE , STOCK_DATE
	) M2
	  WHERE M2.ROWNUM BETWEEN #{paging.boardStart} and #{paging.boardEnd} 
		ORDER BY ROWNUM 
	</select>
	
	<select id="takeinStockInOutExcelDown" parameterType="hashMap" resultType="hashMap">
		DECLARE @ORG_STATION NVARCHAR(3)
		DECLARE @USER_ID NVARCHAR(50)
		DECLARE @TAKE_IN_CODE NVARCHAR(50)
		DECLARE @FROM_DATE NVARCHAR(50)
		DECLARE @TO_DATE NVARCHAR(50)
		
		SET @ORG_STATION = #{orgStation}
		SET @USER_ID = #{userId}
		SET @FROM_DATE = #{fromDate}      
		SET @TO_DATE = #{toDate} 
		
		SELECT ORG_STATION as  orgStation,
		       (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = M1.ORG_STATION) as stationName ,  
		       USER_ID userId , 
		       TAKE_IN_CODE  takeInCode, 
		       (SELECT CUS_ITEM_CODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) cusItemCode ,
		       (SELECT ITEM_BARCODE FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) itemBarCode ,
		       (SELECT ITEM_DETAIL FROM TB_TAKEIN_CODE WHERE TAKE_IN_CODE = M1.TAKE_IN_CODE AND USER_ID = M1.USER_ID AND ORG_STATION = M1.ORG_STATION) itemDetail ,
		       STOCK_DATE  as stockDate , 
		       SUM(WH_IN_CNT) as whInCnt, 
		       SUM(OUT_CNT) as outCnt ,
		       (SELECT COUNT(*) FROM TB_STOCK WHERE WH_IN_DATE <![CDATA[<=]]>  M1.STOCK_DATE AND STOCK_TYEP = 'TAKE_IN' AND TAKE_IN_CODE = M1.TAKE_IN_CODE AND ORG_STATION = M1.ORG_STATION AND USER_ID = M1.USER_ID) -
		       (SELECT COUNT(*) FROM TB_STOCK 
		         WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') <![CDATA[<=]]> M1.STOCK_DATE
		           AND dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') != '' 
		           AND STOCK_TYEP = 'TAKE_IN' AND ISNULL(OUT_NNO,'') != '' AND TAKE_IN_CODE = M1.TAKE_IN_CODE AND ORG_STATION = M1.ORG_STATION AND USER_ID = M1.USER_ID) stockCnt
		FROM ( 
		SELECT ORG_STATION ,
		       USER_ID ,
		       TAKE_IN_CODE, 
		       WH_IN_DATE AS STOCK_DATE,
		       COUNT(*) WH_IN_CNT ,
		       0 OUT_CNT
		 FROM TB_STOCK
		WHERE WH_IN_DATE  BETWEEN @FROM_DATE AND @TO_DATE
		  AND USER_ID = @USER_ID
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE  , WH_IN_DATE , GROUP_IDX
		UNION 
		SELECT ORG_STATION ,
		       USER_ID ,
		       TAKE_IN_CODE, 
			   dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  AS STOCK_DATE ,
		       0 WH_IN_CNT ,
		       COUNT(*)
		 FROM TB_STOCK
		WHERE dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE')  BETWEEN @FROM_DATE AND @TO_DATE 
		  AND ISNULL(OUT_NNO,'') != ''
		  AND USER_ID = @USER_ID
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE , dbo.FN_STOCK_OUT_INFO(OUT_NNO,USER_ID,ORG_STATION,'OUT_DATE') , GROUP_IDX
		) M1
		WHERE ORG_STATION LIKE CONCAT('%',@ORG_STATION,'%')
		  AND USER_ID LIKE CONCAT('%',@USER_ID,'%')
		GROUP BY ORG_STATION , USER_ID , TAKE_IN_CODE , STOCK_DATE
		ORDER BY STOCK_DATE DESC , TAKE_IN_CODE
	</select>
	
	<select id="selectUserTakeinOrderStockOutCnt" parameterType="hashMap" resultType="integer">
		SELECT COUNT(*)
		  FROM (
		SELECT F1.USER_ID , 
		       DENSE_RANK() OVER(ORDER BY  dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') DESC ,  dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') DESC ) ROWNUM ,
		       dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') OUT_DATE ,
		       dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') ORDER_NO ,
		       dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'HAWB_NO') BL_NO ,
		       F1.ORG_STATION , 
		       F1.TAKE_IN_CODE , 
		       F2.CUS_ITEM_CODE ,
		       F2.ITEM_DETAIL,
		       COUNT(*) OUT_CNT 
		  FROM TB_STOCK F1 , 
		       TB_TAKEIN_CODE F2
			 WHERE dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') LIKE CONCAT('%',#{orderNo},'%')
			   AND dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') BETWEEN #{fromDate} AND #{toDate} 
			   AND F1.TAKE_IN_CODE = F2.TAKE_IN_CODE
			   AND ISNULL(OUT_NNO,'') != ''
			   AND dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO,F1.USER_ID,F1.ORG_STATION,'OUT_DATE') != ''
			   AND F1.USER_ID = F2.USER_ID
			   AND F1.ORG_STATION = F2.ORG_STATION
			   AND F1.USER_ID = #{userId}
			   AND F1.ORG_STATION LIKE CONCAT('%',#{orgStation},'%')
		   GROUP BY F1.OUT_NNO ,  
		            F1.USER_ID , 
		            F1.ORG_STATION , 
		            F1.TAKE_IN_CODE,
		            F2.CUS_ITEM_CODE ,
			        F2.ITEM_DETAIL
		   ) M1 
	</select>
	
	<select id="selectUserTakeinOrderStockOut" parameterType="hashMap" resultType="hashMap">
		SELECT ROWNUM,
		       SUB_ROW AS subRow ,
               ROWCNT AS rowCnt ,
		       (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = M1.ORG_STATION) as stationName ,  
		       OUT_DATE as outDate,
		       ORDER_NO as orderNo,
		       BL_NO AS blNo,
		       TAKE_IN_CODE ,
		       CUS_ITEM_CODE as cusItemCode,
		       ITEM_DETAIL as itemDetail,
		       OUT_CNT  as outCnt
	  FROM (SELECT F1.USER_ID , 
	               DENSE_RANK() OVER(ORDER BY  dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') DESC , dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') DESC ) ROWNUM ,
	               ROW_NUMBER() OVER( PARTITION BY dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE')  , dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') 
                          ORDER BY  dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') DESC , dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') DESC , F1.TAKE_IN_CODE ) SUB_ROW ,
                   (SELECT COUNT(*) FROM ( SELECT OUT_NNO , TAKE_IN_CODE FROM TB_STOCK WHERE OUT_NNO = F1.OUT_NNO GROUP BY OUT_NNO , TAKE_IN_CODE) AA ) AS ROWCNT,
	               dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') OUT_DATE ,
	               dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') ORDER_NO ,
	               dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'HAWB_NO') BL_NO ,
	               F1.ORG_STATION , 
	               F1.TAKE_IN_CODE , 
	               F2.CUS_ITEM_CODE ,
	               F2.ITEM_DETAIL,
	               COUNT(*) OUT_CNT 
			  FROM TB_STOCK F1 , 
			       TB_TAKEIN_CODE F2
			 WHERE dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') LIKE CONCAT('%',#{orderNo},'%')
			   AND dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') BETWEEN #{fromDate} AND #{toDate} 
			   AND F1.TAKE_IN_CODE = F2.TAKE_IN_CODE
			   AND ISNULL(OUT_NNO,'') != ''
			   AND dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO,F1.USER_ID,F1.ORG_STATION,'OUT_DATE') != ''
			   AND F1.USER_ID = F2.USER_ID
			   AND F1.ORG_STATION = F2.ORG_STATION
			   AND F1.USER_ID = #{userId}
			   AND F1.ORG_STATION LIKE CONCAT('%',#{orgStation},'%')
			   GROUP BY F1.OUT_NNO ,  
			            F1.USER_ID , 
			            F1.ORG_STATION, 
			            F1.TAKE_IN_CODE,
			            F2.CUS_ITEM_CODE,
				        F2.ITEM_DETAIL
			   ) M1 
				WHERE M1.ROWNUM BETWEEN #{paging.boardStart} and #{paging.boardEnd}
				ORDER BY ROWNUM
	</select>
	<select id="selectUserTakeinOrderStockOutExcel" parameterType="hashMap" resultType="hashMap">
		SELECT ROWNUM,
		       SUB_ROW AS subRow ,
               ROWCNT AS rowCnt ,
		       (SELECT STATION_NAME FROM TB_STATION WHERE STATION_CODE = M1.ORG_STATION) as stationName ,  
		       OUT_DATE as outDate,
		       ORDER_NO as orderNo,
		       BL_NO AS blNo,
		       TAKE_IN_CODE ,
		       CUS_ITEM_CODE as cusItemCode,
		       ITEM_DETAIL as itemDetail,
		       OUT_CNT  as outCnt
	  FROM (SELECT F1.USER_ID , 
	               DENSE_RANK() OVER(ORDER BY  dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') DESC , dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') DESC ) ROWNUM ,
	               ROW_NUMBER() OVER( PARTITION BY dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE')  , dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') 
                          ORDER BY  dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') DESC , dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') DESC , F1.TAKE_IN_CODE ) SUB_ROW ,
                   (SELECT COUNT(*) FROM ( SELECT OUT_NNO , TAKE_IN_CODE FROM TB_STOCK WHERE OUT_NNO = F1.OUT_NNO GROUP BY OUT_NNO , TAKE_IN_CODE) AA ) AS ROWCNT,
	               dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') OUT_DATE ,
	               dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') ORDER_NO ,
	               dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'HAWB_NO') BL_NO ,
	               F1.ORG_STATION , 
	               F1.TAKE_IN_CODE , 
	               F2.CUS_ITEM_CODE ,
	               F2.ITEM_DETAIL,
	               COUNT(*) OUT_CNT 
			  FROM TB_STOCK F1 , 
			       TB_TAKEIN_CODE F2
			 WHERE dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'ORDER_NO') LIKE CONCAT('%',#{orderNo},'%')
			   AND dbo.FN_STOCK_OUT_INFO(F1.OUT_NNO , F1.USER_ID , F1.ORG_STATION , 'OUT_DATE') BETWEEN #{fromDate} AND #{toDate} 
			   AND F1.TAKE_IN_CODE = F2.TAKE_IN_CODE
			   AND ISNULL(OUT_NNO,'') != ''
			   AND F1.USER_ID = F2.USER_ID
			   AND F1.ORG_STATION = F2.ORG_STATION
			   AND F1.USER_ID = #{userId}
			   AND F1.ORG_STATION LIKE CONCAT('%',#{orgStation},'%')
			   GROUP BY F1.OUT_NNO,  
			            F1.USER_ID, 
			            F1.ORG_STATION, 
			            F1.TAKE_IN_CODE,
			            F2.CUS_ITEM_CODE,
				        F2.ITEM_DETAIL
			   ) M1 
			   order by ROWNUM 
	</select>

	<select id="selectTakeinOrderTmpList" resultType="com.example.temp.manager.vo.takein.TakeinOrderListVO" parameterType="hashMap">
		SELECT
			ISNULL(NNO,'') AS NNO,
			ISNULL(ORG_STATION,'') AS ORG_STATION,
			ISNULL(DSTN_NATION,'') AS DSTN_NATION,
			ISNULL((SELECT NATION_E_NAME FROM TB_NATION_CODE WHERE NATION_CODE = F1.DSTN_NATION),'') AS DSTN_E_NAME,
			ISNULL(USER_ID,'') AS USER_ID,
			ISNULL(ORDER_NO,'') AS ORDER_NO,
			ISNULL(ORDER_DATE,'') AS ORDER_DATE,
			ISNULL(SHIPPER_NAME,'') AS SHIPPER_NAME,
			ISNULL(SHIPPER_TEL,'') AS SHIPPER_TEL,
			ISNULL(SHIPPER_HP,'') AS SHIPPER_HP,
			ISNULL(SHIPPER_ZIP,'') AS SHIPPER_ZIP,
			ISNULL(SHIPPER_CITY,'') AS SHIPPER_CITY,
			ISNULL(SHIPPER_STATE,'') AS SHIPPER_STATE,
			ISNULL(SHIPPER_ADDR,'') AS SHIPPER_ADDR,
			ISNULL(SHIPPER_ADDR_DETAIL,'') AS SHIPPER_ADDR_DETAIL,
			ISNULL(CNEE_NAME,'') AS CNEE_NAME,
			ISNULL(CNEE_TEL,'') AS CNEE_TEL,
			ISNULL(CNEE_HP,'') AS CNEE_HP,
			ISNULL(CNEE_EMAIL,'') AS CNEE_EMAIL,
			ISNULL(CNEE_ZIP,'') AS CNEE_ZIP,
			ISNULL(CNEE_CITY,'') AS CNEE_CITY,
			ISNULL(CNEE_STATE,'') AS CNEE_STATE,
			ISNULL(CNEE_ADDR,'') AS CNEE_ADDR,
			ISNULL(CNEE_ADDR_DETAIL,'') AS CNEE_ADDR_DETAIL,
			ISNULL(DLV_REQ_MSG,'') AS DLV_REQ_MSG,
			ISNULL(BUY_SITE,'') AS BUY_SITE,
			ISNULL(WH_REQ_MSG,'') AS WH_REQ_MSG
		FROM
			TMP_ORDER_LIST F1
		WHERE
			NNO = #{nno}
			AND USER_ID = #{userId}
			AND ORG_STATION = #{orgStation}
			AND ORDER_TYPE = 'TAKEIN'
	</select>
	
	<select id="selectUserCusItemList" parameterType="hashMap" resultType="hashMap">
		SELECT 
			USER_ID as userId,
			TAKE_IN_CODE as takeInCode, 
			CUS_ITEM_CODE as cusItemCode, 
			ITEM_DETAIL as itemDetail ,
			ITEM_OPTION as itemOption,
			UNIT_VALUE as unitValue,
			BRAND as brand,
			ITEM_IMG_URL as itemImgUrl
		FROM 
			TB_TAKEIN_CODE 
		WHERE 
			USER_ID LIKE CONCAT('%',#{userId},'%') 
		ORDER BY 
			ITEM_DETAIL ASC
	</select>
	
	<select id="selectTakeinCusItemInJson" parameterType="hashMap" resultType="hashMap">
		SELECT 
			USER_ID as userId,
			TAKE_IN_CODE as takeInCode, 
			CUS_ITEM_CODE as cusItemCode, 
			ISNULL(ITEM_DETAIL,'') as itemDetail ,
			ISNULL(ITEM_OPTION,'') as itemOption,
			ISNULL(UNIT_VALUE,0) as unitValue,
			ISNULL(BRAND,'') as brand,
			ISNULL(ITEM_IMG_URL,'') as itemImgUrl,
			ISNULL(UNIT_CURRENCY,'') as unitCurrency,
			ISNULL(NATIVE_ITEM_DETAIL,'') as nativeItemDetail
		FROM 
			TB_TAKEIN_CODE 
		WHERE 
			USER_ID LIKE CONCAT('%',#{userId},'%')
			AND CUS_ITEM_CODE = #{cusItemCode} 
		ORDER BY 
			ITEM_DETAIL ASC
	</select>
	
	
	<select id="selectCurrencyList" parameterType="hashMap" resultType="com.example.temp.manager.vo.CurrencyVO">
		SELECT *
		FROM TB_CURRENCY
		WHERE NATION_CODE IN (SELECT DSTN_NATION FROM TB_ORDER_LIST GROUP BY DSTN_NATION)
	</select>
	
	<delete id="deleteUserOrderItemTmp" parameterType="String">
		DELETE FROM TMP_ORDER_ITEM WHERE 
		NNO = #{nno};
		DELETE FROM TB_RUS_ORDER_ITEM_INFO WHERE 
		NNO = #{nno};
	</delete>
	
	<delete id="deleteUserOrderItem" parameterType="String">
		DELETE FROM TB_ORDER_ITEM WHERE 
		NNO = #{nno};
		DELETE FROM TB_RUS_ORDER_ITEM_INFO WHERE 
		NNO = #{nno};
	</delete>
	
	<select id="confirmOrderList" parameterType="com.example.temp.member.vo.UserOrderListVO" resultType="Integer">
		SELECT COUNT(*) FROM TB_ORDER_LIST WHERE ORDER_NO = #{orderNo} AND USER_ID = #{userId}
	</select>
	
	<select id="confirmOrderListTemp" parameterType="com.example.temp.member.vo.UserOrderListVO" resultType="Integer">
		SELECT COUNT(*) FROM TMP_ORDER_LIST WHERE ORDER_NO = #{orderNo} AND USER_ID = #{userId}
	</select>
	
	<insert id="insertTakeinOrderItemTemp" parameterType="com.example.temp.member.vo.UserOrderItemVO">
		INSERT INTO TMP_ORDER_ITEM (
			NNO, SUB_NO, ORG_STATION, USER_ID, HS_CODE, TAKE_IN_CODE, ITEM_DETAIL, ITEM_CNT,
			BRAND, MAKE_CNTRY, MAKE_COM, ITEM_DIV, WT_UNIT, QTY_UNIT, PACKAGE_UNIT, EXCHANGE_RATE,
			CHG_AMT, ITEM_METERIAL, USER_WTA, USER_WTC, ITEM_URL, ITEM_IMG_URL, STATUS, TRK_COM, TRK_NO, TRK_DATE,  
			UNIT_CURRENCY,
			UNIT_VALUE,
			CHG_CURRENCY,
			NATIVE_ITEM_DETAIL, CUS_ITEM_CODE, W_USER_ID, W_USER_IP, W_DATE
		)
		SELECT
			#{nno} as NNO, #{subNo} as SUB_NO, #{orgStation} as ORG_STATION, #{userId} as USER_ID, HS_CODE, TAKE_IN_CODE, ITEM_DETAIL, #{itemCnt} as ITEM_CNT,
			BRAND, MAKE_CNTRY, MAKE_COM, ITEM_DIV, WT_UNIT, QTY_UNIT, NULL PACKAGE_UNIT, NULL EXCHANGE_RATE,
			NULL CHG_AMT, ITEM_METERIAL, WTA, WTC, ITEM_URL, ITEM_IMG_URL, NULL STATUS, NULL TRK_COM, NULL TRK_NO, GETDATE(),
	<choose>
		<when test='chgCurrency != null and chgCurrency != ""'>
			#{chgCurrency} AS UNIT_CURRENCY,
		</when>
		<otherwise>
			UNIT_CURRENCY,
		</otherwise>
	</choose>
	<choose>
		<when test='unitValue != null and unitValue != ""'>
			#{unitValue} AS UNIT_VALUE,
		</when>
		<otherwise>
			UNIT_VALUE,
		</otherwise>
	</choose>
	<choose>
		<when test='chgCurrency != null and chgCurrency != ""'>
			#{chgCurrency} AS UNIT_CURRENCY,
		</when>
		<otherwise>
			UNIT_CURRENCY,
		</otherwise>
	</choose> 
	<choose>
		<when test='nativeItemDetail != null and nativeItemDetail != ""'>
			#{nativeItemDetail} AS NATIVE_ITEM_DETAIL,
		</when>
		<otherwise>
			NATIVE_ITEM_DETAIL,
		</otherwise>
	</choose>
			CUS_ITEM_CODE, #{wUserId} as W_USER_ID, #{wUserIp} as W_USER_IP, GETDATE()
		FROM TB_TAKEIN_CODE F1 
		WHERE ORG_STATION = #{orgStation}
		  AND USER_ID = #{userId}
		  AND CUS_ITEM_CODE = #{cusItemCode}
	</insert>
	
	<insert id="insertTakeinOrderItem" parameterType="com.example.temp.member.vo.UserOrderItemVO">
		INSERT INTO TB_ORDER_ITEM 
		(NNO,SUB_NO,ORG_STATION,USER_ID,HS_CODE,TAKE_IN_CODE,ITEM_DETAIL,UNIT_CURRENCY,ITEM_CNT,UNIT_VALUE,BRAND,MAKE_CNTRY,MAKE_COM,ITEM_DIV,WT_UNIT,QTY_UNIT,PACKAGE_UNIT,EXCHANGE_RATE,CHG_CURRENCY,CHG_AMT,ITEM_METERIAL,USER_WTA,USER_WTC,ITEM_URL,ITEM_IMG_URL,STATUS,TRK_COM,TRK_NO,TRK_DATE,NATIVE_ITEM_DETAIL,CUS_ITEM_CODE,W_USER_ID,W_USER_IP,W_DATE)
		SELECT #{nno} NNO, #{subNo} SUB_NO, #{orgStation} ORG_STATION, #{userId} USER_ID,
		      HS_CODE,
		      TAKE_IN_CODE ,
		      ITEM_DETAIL,
		      (SELECT CURRENCY FROM TB_CURRENCY WHERE NATION_CODE = (SELECT DSTN_NATION FROM TMP_ORDER_LIST WHERE NNO = #{nno})),
		      #{itemCnt} ITEM_CNT,
		      case when ISNULL(#{unitValue},'0') = '0' then F1.UNIT_VALUE else #{unitValue} END  as UNIT_VALUE,
		      BRAND,MAKE_CNTRY,MAKE_COM,ITEM_DIV,WT_UNIT,QTY_UNIT,
		      NULL PACKAGE_UNIT,NULL EXCHANGE_RATE,NULL CHG_CURRENCY,NULL CHG_AMT, 
		      ITEM_METERIAL,WTA USER_WTA,WTC USER_WTC,ITEM_URL,ITEM_IMG_URL,
		      '' STATUS,'' TRK_COM,'' TRK_NO,'' TRK_DATE,NATIVE_ITEM_DETAIL, CUS_ITEM_CODE,NULL
		      W_USER_ID,W_USER_IP,W_DATE
		FROM TB_TAKEIN_CODE F1 
		WHERE ORG_STATION = #{orgStation}
		  AND USER_ID = #{userId} 
		  AND CUS_ITEM_CODE = #{cusItemCode};
	</insert>
	
	<select id="selectTakeinCodeListCnt" parameterType="hashMap" resultType="Integer">
		SELECT COUNT(*)
		FROM TB_TAKEIN_CODE
		WHERE USER_ID = #{userId}
	</select>
	
	<delete id="deleteExplicenceInfo" parameterType="hashMap">
		DELETE FROM TB_EXPLICENCE WHERE NNO = #{nno};
	</delete>
</mapper>